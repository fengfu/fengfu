<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta property="og:type" content="website">
<meta property="og:title" content="宁静·致远">
<meta property="og:url" content="http://fengfu.io/page/2/index.html">
<meta property="og:site_name" content="宁静·致远">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="宁静·致远">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://fengfu.io/page/2/"/>





  <title>宁静·致远</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">宁静·致远</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/index.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-rss">
          <a href="/atom.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            RSS
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fengfu.io/2017/03/06/Spring Xml扩展机制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宁静·致远">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宁静·致远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/06/Spring Xml扩展机制/" itemprop="url">Spring xml扩展机制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-06T18:41:09+08:00">
                2017-03-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/03/06/Spring Xml扩展机制/" class="leancloud_visitors" data-flag-title="Spring xml扩展机制">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Spring框架从2.0版本开始，提供了基于Schema风格的XML扩展机制，允许开发者扩展最基本的spring配置文件，这样我们就可以编写自定义的xml bean解析器然后集成到Spring IoC容器中。很多支持Spring的框架，比如Dubbo、mybatis都提供了对Spring xml扩展的支持。</p>
<p>Xml扩展大概有以下几个步骤：</p>
<ul>
<li>编写xml schema来描述自定义元素</li>
<li>编写自定义类</li>
<li>编写<code>NamespaceHandler</code>的实现类</li>
<li>编写<code>BeanDefinitionParser</code>实现类</li>
<li>把上述组件注册到Spring</li>
</ul>
<h2 id="编写自定义schema"><a href="#编写自定义schema" class="headerlink" title="编写自定义schema"></a>编写自定义schema</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">xsd:schema</span> <span class="attr">xmlns</span>=<span class="string">"http://www.mycompany.com/schema/product"</span></span></div><div class="line">        <span class="attr">xmlns:xsd</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span></div><div class="line">        <span class="attr">xmlns:beans</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></div><div class="line">        <span class="attr">targetNamespace</span>=<span class="string">"http://www.mycompany.com/schema/product"</span></div><div class="line">        <span class="attr">elementFormDefault</span>=<span class="string">"qualified"</span></div><div class="line">        <span class="attr">attributeFormDefault</span>=<span class="string">"unqualified"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">xsd:import</span> <span class="attr">namespace</span>=<span class="string">"http://www.springframework.org/schema/beans"</span>/&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"robot"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">xsd:complexType</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">xsd:complexContent</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">xsd:extension</span> <span class="attr">base</span>=<span class="string">"beans:identifiedType"</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">"brand"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> <span class="attr">use</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">										<span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">"type"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> <span class="attr">use</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">"height"</span> <span class="attr">type</span>=<span class="string">"xsd:int"</span>/&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">"weight"</span> <span class="attr">type</span>=<span class="string">"xsd:float"</span>/&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">xsd:extension</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">xsd:complexContent</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">xsd:complexType</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">xsd:element</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xsd:schema</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="编写自定义类"><a href="#编写自定义类" class="headerlink" title="编写自定义类"></a>编写自定义类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Robot</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> String brand;</div><div class="line">	<span class="keyword">private</span> String type;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">int</span> height;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">float</span> weight;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后我们就可以在xml中定义如下的robot元素:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">product:robot</span> <span class="attr">id</span>=<span class="string">"bb8"</span> <span class="attr">brand</span>=<span class="string">"StarWar"</span> <span class="attr">type</span>=<span class="string">"bb8"</span> <span class="attr">height</span>=<span class="string">"100"</span> <span class="attr">weight</span>=<span class="string">"20"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="编写NamespaceHandler"><a href="#编写NamespaceHandler" class="headerlink" title="编写NamespaceHandler"></a>编写NamespaceHandler</h2><p><code>NamespaceHandler</code>用于解析我们自定义名字空间下的所有元素，目前我们要解析上面的<code>product:robot</code>元素。<br><code>NamespaceHandler</code>里面只有3个方法：</p>
<ul>
<li><code>init()</code>会在<code>NamespaceHandler</code>初始化的时候被调用。</li>
<li><code>BeanDefinition parse(Element, ParserContext)</code> - 当Spring遇到一个顶层元素的时候被调用。</li>
<li><code>BeanDefinitionHolder decorate(Node, BeanDefinitionHolder, ParserContext)</code> - 当Spring遇到一个属性或嵌套元素的时候调用.</li>
</ul>
<p>Spring提供了默认实现类<code>NamespaceHandlerSupport</code>，我们只需在init的时候注册每个元素的解析器即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductNamespaceHandler</span> <span class="keyword">extends</span> <span class="title">NamespaceHandlerSupport</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">//遇到robot元素的时候交给RobotBeanDefinitionParser来解析</span></div><div class="line">		registerBeanDefinitionParser(<span class="string">"robot"</span>, <span class="keyword">new</span> RobotBeanDefinitionParser());</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="编写BeanDefinitionParser"><a href="#编写BeanDefinitionParser" class="headerlink" title="编写BeanDefinitionParser"></a>编写BeanDefinitionParser</h2><p>这样在解析xml过程中遇到robot元素时，Spring会交给RobotBeanDefinitionParser来解析。RobotBeanDefinitionParser取出相应的属性然后设置到bean中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RobotBeanDefinitionParser</span> <span class="keyword">extends</span> <span class="title">AbstractSingleBeanDefinitionParser</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">protected</span> Class&lt;?&gt; getBeanClass(Element element) &#123;</div><div class="line">		<span class="comment">//robot元素对应Robot对象类型</span></div><div class="line">		<span class="keyword">return</span> Robot.class;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doParse</span><span class="params">(Element element, BeanDefinitionBuilder builder)</span> </span>&#123;</div><div class="line"></div><div class="line">		String brand = element.getAttribute(<span class="string">"brand"</span>);</div><div class="line">		String type = element.getAttribute(<span class="string">"type"</span>);</div><div class="line">		String height = element.getAttribute(<span class="string">"height"</span>);</div><div class="line">		String weight = element.getAttribute(<span class="string">"weight"</span>);</div><div class="line"></div><div class="line">		<span class="comment">//把对应的属性设置到bean中</span></div><div class="line">		<span class="keyword">if</span>(StringUtils.hasText(brand))</div><div class="line">			builder.addPropertyValue(<span class="string">"brand"</span>, brand);</div><div class="line"></div><div class="line">		<span class="keyword">if</span>(StringUtils.hasText(type))</div><div class="line">			builder.addPropertyValue(<span class="string">"type"</span>, type);</div><div class="line"></div><div class="line">		<span class="keyword">if</span>(StringUtils.hasText(height))</div><div class="line">			builder.addPropertyValue(<span class="string">"height"</span>, height);</div><div class="line"></div><div class="line">		<span class="keyword">if</span>(StringUtils.hasText(weight))</div><div class="line">			builder.addPropertyValue(<span class="string">"weight"</span>, weight);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="注册handler和schema"><a href="#注册handler和schema" class="headerlink" title="注册handler和schema"></a>注册handler和schema</h2><p>为了让Spring在解析xml的时候能够感知到我们的自定义元素，我们需要把<code>namespaceHandler</code>和xsd文件放到2个指定的配置文件中，这2个文件都位于<code>META-INF</code>目录中。</p>
<h4 id="META-INF-spring-handlers"><a href="#META-INF-spring-handlers" class="headerlink" title="META-INF/spring.handlers"></a>META-INF/spring.handlers</h4><p><code>`spring.handlers` </code>文件包含了xml schema uri和handler类的映射关系，比如：</p>
<blockquote>
<p>http\://www.mycompany.com/schema/product=spring.xml.ext.schema.ProductNamespaceHandler</p>
</blockquote>
<p>这表示遇到<code>http://www.mycompany.com/schema/product</code>命名空间的时候会交给<code>ProductNamespaceHandler</code>来处理。</p>
<p>注意上面的冒号转义。<br>key部分必须和xsd文件中的<code>targetNamespace</code>值保持一致。</p>
<h4 id="META-INF-spring-schemas"><a href="#META-INF-spring-schemas" class="headerlink" title="META-INF/spring.schemas"></a>META-INF/spring.schemas</h4><blockquote>
<p>http\://www.mycompany.com/schema/product.xsd=META-INF/product.xsd</p>
</blockquote>
<h2 id="最后测试下"><a href="#最后测试下" class="headerlink" title="最后测试下"></a>最后测试下</h2><p>写个Spring配置文件products.xml：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> 	<span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">		<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">		<span class="attr">xmlns:my</span>=<span class="string">"http://www.mycompany.com/schema/product"</span></div><div class="line">		<span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></div><div class="line">	        http://www.springframework.org/schema/beans</div><div class="line">	        http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">	        http://www.mycompany.com/schema/product</div><div class="line">	        http://www.mycompany.com/schema/product.xsd"&gt;</div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">product:robot</span> <span class="attr">id</span>=<span class="string">"bb8"</span> <span class="attr">brand</span>=<span class="string">"StarWar"</span> <span class="attr">type</span>=<span class="string">"bb8"</span> <span class="attr">height</span>=<span class="string">"100"</span> <span class="attr">weight</span>=<span class="string">"20"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>测试类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@ContextConfiguration</span>(locations = &#123; <span class="string">"classpath:products.xml"</span> &#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SchemaTest</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">	<span class="meta">@Qualifier</span>(<span class="string">"bb8"</span>)</div><div class="line">	<span class="keyword">private</span> Robot robot;</div><div class="line"></div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">propertyTest</span><span class="params">()</span> </span>&#123;</div><div class="line">		assertNotNull(robot);</div><div class="line"></div><div class="line">		String brand = robot.getBrand();</div><div class="line">		String type = robot.getType();</div><div class="line">		<span class="keyword">int</span> height = robot.getHeight();</div><div class="line">		<span class="keyword">float</span> weight = robot.getWeight();</div><div class="line"></div><div class="line">		assertEquals(<span class="string">"Brand should be bb8."</span>, <span class="string">"bb8"</span>, brand);</div><div class="line">		assertEquals(<span class="string">"Type should be bb8."</span>, <span class="string">"bb8"</span>, type);</div><div class="line">		assertEquals(<span class="string">"Height should be 100."</span>, <span class="number">100</span>, height);</div><div class="line">		assertEquals(<span class="string">"Weight should be 20."</span>, <span class="number">20</span>, weight);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://blog.csdn.net/cutesource/article/details/5864562" target="_blank">基于Spring可扩展Schema提供自定义配置支持</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fengfu.io/2016/12/14/jcmd命令详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宁静·致远">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宁静·致远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/14/jcmd命令详解/" itemprop="url">jcmd命令详解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-14T16:28:59+08:00">
                2016-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2016/12/14/jcmd命令详解/" class="leancloud_visitors" data-flag-title="jcmd命令详解">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>在JDK 1.7及之后的版本，新增了一个命令行工具jcmd。它是一个多功能工具，可以做哪些事情呢？这里先卖个关子，先来看看Oracle官方对jcmd的介绍:</p>
<p><em>The jcmd utility is used to send diagnostic command requests to the JVM, where these requests are useful for controlling Java Flight Recordings, troubleshoot, and diagnose JVM and Java Applications. It must be used on the same machine where the JVM is running, and have the same effective user and group identifiers that were used to launch the JVM.</em></p>
<p>翻译成人话就是：<br>jcmd一个用来发送诊断命令请求到JVM的工具，这些请求对于控制Java飞行记录器、故障排除、JVM和Java应用诊断来说是比较有用的。jcmd必须与正在运行的JVM在同一台机器上使用，并且使用启动该JVM时的用户权限。</p>
<h1 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h1><p>jcmd的用法是:<br><code>jcmd &lt;process id/main class&gt; &lt;command&gt; [options]</code></p>
<p>其中command的说明如下：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>help</td>
<td>打印帮助信息，示例：jcmd <pid> help [<command name="">]</pid></td>
</tr>
<tr>
<td>ManagementAgent.stop</td>
<td>停止JMX Agent</td>
</tr>
<tr>
<td>ManagementAgent.start_local</td>
<td>开启本地JMX Agent</td>
</tr>
<tr>
<td>ManagementAgent.start</td>
<td>开启JMX Agent</td>
</tr>
<tr>
<td>Thread.print</td>
<td>参数-l打印java.util.concurrent锁信息，相当于：jstack <pid></pid></td>
</tr>
<tr>
<td>PerfCounter.print</td>
<td>相当于：jstat -J-Djstat.showUnsupported=true -snap <pid></pid></td>
</tr>
<tr>
<td>GC.class_histogram</td>
<td>相当于：jmap -histo <pid></pid></td>
</tr>
<tr>
<td>GC.heap_dump</td>
<td>相当于：jmap -dump:format=b,file=xxx.bin <pid></pid></td>
</tr>
<tr>
<td>GC.run_finalization</td>
<td>相当于：System.runFinalization()</td>
</tr>
<tr>
<td>GC.run</td>
<td>相当于：System.gc()</td>
</tr>
<tr>
<td>VM.uptime</td>
<td>参数-date打印当前时间，VM启动到现在的时候，以秒为单位显示</td>
</tr>
<tr>
<td>VM.flags</td>
<td>参数-all输出全部，相当于：jinfo -flags <pid>, jinfo -flag <vm flag=""> <pid></pid></vm></pid></td>
</tr>
<tr>
<td>VM.system_properties</td>
<td>相当于：jinfo -sysprops <pid></pid></td>
</tr>
<tr>
<td>VM.command_line</td>
<td>相当于：jinfo -sysprops <pid></pid></td>
<td>grep command</td>
</tr>
<tr>
<td>VM.version</td>
<td>相当于：jinfo -sysprops <pid></pid></td>
<td>grep version</td>
</tr>
</tbody>
</table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fengfu.io/2016/11/23/服务化架构-注册与发现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宁静·致远">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宁静·致远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/23/服务化架构-注册与发现/" itemprop="url">服务化架构-注册与发现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-23T14:21:40+08:00">
                2016-11-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2016/11/23/服务化架构-注册与发现/" class="leancloud_visitors" data-flag-title="服务化架构-注册与发现">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="基本功能"><a href="#基本功能" class="headerlink" title="基本功能"></a>基本功能</h1><p>在分布式系统中，服务提供端和消费端彼此不知道对方的存在，因此需要有一种机制来确保消费端能够找到提供端并进行调用。一般来说，提供端需要将自己能够提供的服务信息暴露出来，这样消费端通过检索就能找到自己需要的服务并建立连接进行调用。所以，对于服务提供端来讲，需要具备以下功能：</p>
<ol>
<li>服务注册：将服务信息暴露出来，供消费端查找和使用</li>
<li>取消注册：即注销服务的注册信息</li>
</ol>
<p>同时，对于消费端来说，则需要：</p>
<ol>
<li>服务检索：按一定条件查找服务信息，如按应用、接口、IP等检索</li>
<li>服务订阅：订阅特定的服务，为后面的服务调用和治理做前期准备</li>
<li>取消订阅：取消指定服务的订阅</li>
</ol>
<h1 id="结构组成"><a href="#结构组成" class="headerlink" title="结构组成"></a>结构组成</h1><p>在这种情况下，注册中心的概念就被提了出来。</p>
<p>同时，系统间调用需要能够根据服务的运行状态(如上下线状态、负载、响应时间、网络情况等)而灵活调整调用端与服务端的组合。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fengfu.io/2016/11/23/服务化架构-组成/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宁静·致远">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宁静·致远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/23/服务化架构-组成/" itemprop="url">服务化架构-组成</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-23T14:21:06+08:00">
                2016-11-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2016/11/23/服务化架构-组成/" class="leancloud_visitors" data-flag-title="服务化架构-组成">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="功能结构"><a href="#功能结构" class="headerlink" title="功能结构"></a>功能结构</h1><p>既然是服务化架构，那么肯定会包含服务提供方和调用方，即provider和consumer。那么作为分布式的服务化架构，需要有一个地方存储provider的信息，便于consumer调用，那么这个角色就是注册中心(registry)。</p>
<p>另外，鉴于分布式系统的复杂性和状态多样性，我们需要对provider、consumer、registry进行管理，比如服务依赖管理、权限管理、配置管理、版本管理、流量控制、服务上下线等，那么管理端(administrator)也就成了标配。</p>
<p>所以综上所述，一个完整的分布式服务化架构，应该包含4部分：</p>
<ol>
<li>注册中心Registry</li>
<li>服务提供端Provider</li>
<li>服务消费端Consumer</li>
<li>管理端Administrator</li>
</ol>
<p><img src="https://img.alicdn.com/imgextra/i3/2657627814/TB2_wgncKNOdeFjSZFBXXctzXXa_!!2657627814.png" alt=""></p>
<p>其中，Provider将自己能够提供的服务信息登记到注册中心，同时通过心跳的方式定时更新自己的状态。Consumer从Registry获取可用服务信息后，直接与Provider建立连接进行交互。</p>
<p>这种架构，基于RPC的服务框架如dubbo/dubbox，JSF都是采用这种机制。</p>
<p>另外，一些基于REST的服务框架（比如Spring Cloud）会增加服务路由的组件，也就是说Consumer需要经过服务路由才能请求Provider，这种方式下，其架构就是由5部分组成：</p>
<ol>
<li>注册中心Registry</li>
<li>服务提供端Provider</li>
<li>服务消费端Consumer</li>
<li>服务路由Router</li>
<li>管理端Administrator</li>
</ol>
<p><img src="https://img.alicdn.com/imgextra/i4/2657627814/TB29vfhdNaJ.eBjSsziXXaJ_XXa_!!2657627814.png" alt=""></p>
<p>经由服务路由调用的方式，典型的代表是Spring Cloud，如下图：</p>
<p><img src="https://img.alicdn.com/imgextra/i3/2657627814/TB28lS_dH1J.eBjSszcXXbFzVXa_!!2657627814.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fengfu.io/2016/11/23/服务化架构-前言/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宁静·致远">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宁静·致远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/23/服务化架构-前言/" itemprop="url">服务化架构-前言</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-23T11:20:00+08:00">
                2016-11-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2016/11/23/服务化架构-前言/" class="leancloud_visitors" data-flag-title="服务化架构-前言">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>近两年，微服务的概念逐渐火了起来，而docker的出现，更是在微服务的火上浇了一桶油。纯粹地讲，我不太认同微服务的说法。说白了，你还是一个服务，只是因为你的小微，有些地方你需要特别注意，比如高内聚、低耦合，比如团队规模的“两个披萨”原则等。但其实这些原则对于“服务”的世界来讲，早就是普世价值了。</p>
<p>那我们再往前看5年，那时候服务化的架构已经开始在业界崭露头角，比如2011年的时候，阿里把内部的dubbo框架开源了。从当前的标准来看，dubbo并不是一个非常优秀的服务化框架，它有很多缺陷和缺失，但是在5年前，这已经难能可贵了。</p>
<p>上周，在朋友的公司做了一次服务化架构的内训。为了准备这个PPT，特地将服务化框架的体系做了一个梳理，因此决定趁热打铁，写个系列博客进行更进一步的总结。</p>
<p>这个系列的文章，将从以下几个方面进行总结：</p>
<ol>
<li>服务化架构的组成</li>
<li>服务注册与发现</li>
<li>RPC</li>
<li>同步与异步</li>
<li>服务依赖管理</li>
<li>服务链路跟踪</li>
<li>服务路由</li>
<li>服务负载均衡</li>
<li>服务降级</li>
<li>服务限流</li>
<li>服务上下线</li>
<li>服务授权</li>
<li>服务监控与告警</li>
<li>服务版本管理</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fengfu.io/2016/10/27/晋级Review归来话代码有毒/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宁静·致远">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宁静·致远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/27/晋级Review归来话代码有毒/" itemprop="url">晋级Review归来话代码有毒</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-27T15:36:55+08:00">
                2016-10-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2016/10/27/晋级Review归来话代码有毒/" class="leancloud_visitors" data-flag-title="晋级Review归来话代码有毒">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这几天做应届生的转正定级答辩，结束后小黑哥在朋友圈里面发了下面一幅图：</p>
<p><img src="https://img.alicdn.com/imgextra/i3/2657627814/TB2qDgda71M.eBjSZPiXXawfpXa_!!2657627814.jpg" alt=""></p>
<p>并在评论里面说了一句话：网络不超时，堆外不清理，异步不回调，异常不监控。</p>
<p>上面的中毒情况总结得非常不错，这让我想起了《唐伯虎点秋香》里面的一段情节：</p>
<p><img src="https://img.alicdn.com/imgextra/i3/2657627814/TB2Poz0aHaI.eBjy1XdXXcoqXXa_!!2657627814.jpg" alt=""></p>
<p>华夫人对唐伯虎说：一日丧命散是用七种不同的毒虫再加上那鹤顶红提炼七七四十九天而成的，无色无味，杀人于无影无踪。吃了我们一日丧命散的人，一天之内会武功全失，经脉逆流，胡思乱想而至走火入魔，最后啊，会血管爆裂而死。</p>
<p>借着这个情节和小黑哥的中毒，来总结一下代码里面的七种毒虫吧。</p>
<p><img src="https://img.alicdn.com/imgextra/i1/2657627814/TB2Qegea71M.eBjSZPiXXawfpXa_!!2657627814.jpg" alt=""></p>
<h1 id="1-资源不限制"><a href="#1-资源不限制" class="headerlink" title="1.资源不限制"></a>1.资源不限制</h1><p>这是很多码农容易中的毒，典型的症状是：</p>
<h2 id="1-1-缓存不设置最大数量限制"><a href="#1-1-缓存不设置最大数量限制" class="headerlink" title="1.1 缓存不设置最大数量限制"></a>1.1 缓存不设置最大数量限制</h2><p>比如我们使用map实现了一个cache，但是没有设置cache的大小，久而久之你可以想象一下这个cache最终会膨胀到什么程度。当然有同学可能会说我使用的是Guava cache，可以设置数量限制。well done，你再回去看看你的full gc是不是比较频繁，没准是因为这个值太大导致的哟~</p>
<h2 id="1-2-线程池不设置队列大小"><a href="#1-2-线程池不设置队列大小" class="headerlink" title="1.2 线程池不设置队列大小"></a>1.2 线程池不设置队列大小</h2><p>比如我们使用newFixedThreadPool，但是我们没有设置队列的大小，而悲催的是，在java中，线程池队列的默认大小是Integer.MAX_VALUE，我想你自己也能清楚这种情况下会发生什么问题。<br>再比如Executors.newCachedThreadPool，这个接口很多人会用到，但很多用的人都没有仔细想过会不会在某种情况下这里创建出巨多的线程。</p>
<h1 id="2-网络不超时"><a href="#2-网络不超时" class="headerlink" title="2.网络不超时"></a>2.网络不超时</h1><p>这里说的是网络调用的场景不设置超时。</p>
<p>在服务化设计大行其道的今天，我们很多的服务调用都是通过网络调用进行的。设想一下，如果我们调用的某个服务性能低下或者网络异常，长时间没有返回结果，那么调用端线程就会一直阻塞在这里。如果没有使用线程池，那么应用会阻塞在这里。如果使用了线程池，那么线程就会长时间阻塞，最终导致线程池爆掉。</p>
<p>在review代码的时候，这种情况尤其常见，尤其是使用httpclient的时候，各位看官要多加注意哟。</p>
<h1 id="3-自我不保护"><a href="#3-自我不保护" class="headerlink" title="3.自我不保护"></a>3.自我不保护</h1><p>这种情况尤其常见于对外提供接口的情况。对于调用方传过来的参数，我们没有做严格的有效性检查或者限制，最终导致不符合要求的数据将程序搞挂。比如我们提供了一个用户信息批量查询的接口，参数是一个数组。结果是某个调用方传了有1000个元素的数组过来，最终可能直接导致程序内存溢出……这种情况我们能去怪罪调用方吗？严格来说，我们不能，在这里可以借鉴一句经典的话：不要相信前端传来的任何数据。我想对于接口也是一样：不要相信调用端传来的任何数据。</p>
<p>还有一种情况就是系统处理能力的保护，最典型的就是QPS。如果我们的系统能够承受的QPS是100，那么如果QPS超过这个数值，我们该怎么办？我想很多人心里已经有了答案了。</p>
<h1 id="4-连接不关闭"><a href="#4-连接不关闭" class="headerlink" title="4.连接不关闭"></a>4.连接不关闭</h1><p>这里其实是有两点要强调，连接和流。</p>
<h2 id="4-1-连接不关闭"><a href="#4-1-连接不关闭" class="headerlink" title="4.1 连接不关闭"></a>4.1 连接不关闭</h2><p>说到连接，这里所说的是网络连接。我们都知道，网络资源是一种受限资源，无限制的网络连接会给自身及对方系统带来很大的压力，因此我们会使用连接池或其他连接复用技术来降低系统压力，以此提高效率。但是如果我们忘记了关闭连接的话，就会对对端系统带来隐患。比如数据库连接，如果忘记关闭，会造成数据库服务器连接资源耗尽最终导致拒绝服务。当然有同学说，现在很多服务器都有超时检查机制，长时间不活动的连接会自动清除。那么你想过没有，如果连接被服务器断开，这种情况下客户端是感知不到的。只有你下次使用的时候才发现连接已经不可用了。</p>
<h2 id="4-2-流不关闭"><a href="#4-2-流不关闭" class="headerlink" title="4.2 流不关闭"></a>4.2 流不关闭</h2><p>流的问题很好理解，我们读写文件、网络传输，很多很多场景需要使用流，而在操作系统层面，对文件、网络的操作都是有限制的。在使用流的时候，我们首先需要进行open，最后close。如果我们忘记了close，那么系统就不会释放对此资源的占用，最终超出系统限制而导致后续的操作失败，最典型的错误就是too many open files。</p>
<h1 id="5-异步不回调"><a href="#5-异步不回调" class="headerlink" title="5.异步不回调"></a>5.异步不回调</h1><p>在分布式服务架构中，很多的服务为了提高并发处理能力，使用了异步机制。异步的好处是消费端可以不必一直等待服务端的结果，而将资源交给其他的逻辑处理。当服务端有结果返回时，通过回调机制调用消费端的逻辑进行后续的处理。但是在实际的使用过程中，发现很多人还是使用同步的方式来调用异步方法，比如：</p>
<pre><code>fooService.findFoo(fooId); //fooService.findFoo方法支持异步
Future&lt;Foo&gt; fooFuture = RpcContext.getContext().getFuture(); 

Foo foo = fooFuture.get(); // 如果foo已返回，直接拿到返回值，否则线程wait住，等待foo返回后，线程会被notify唤醒
</code></pre><p>我们知道Future对象具有如下的特性：</p>
<ol>
<li>异步执行，可用 get 方法获取执行结果；</li>
<li>如果计算还没完成，get 方法是会阻塞的，如果完成了，是可以多次获取并立即得到结果的；</li>
<li>如果计算还没完成，是可以取消计算的；</li>
<li>可以查询计算的执行状态</li>
</ol>
<p>所以上述的代码问题主要出现在第3行，如果fooService.findFoo方法还没有返回值，那么fooFuture.get()方法会被阻塞直到结果返回，这样就失去了异步调用的优势了。</p>
<p>那么针对上面的代码，正确的写法应该是通过回调机制做数据返回时的处理：</p>
<pre><code>fooService.findFoo(fooId);  

ResponseFuture future = ((FutureAdapter)RpcContext.getContext().getFuture()).getFuture();
future.setCallback(new ResponseCallback(){
    public void done(Object response){
       //调用正常的时候执行
    }

    public void caught(Throwable exception){
      //调用异常的时候执行
    }
});
</code></pre><p>当然，上面的方式只是举了个栗子，具体情况需要根据不同的RPC框架去做处理。这里推荐Google guava concurrent包里面的接口和工具类，比如ListenableFuture、Futures等，具体实例网上有很多的说明，请大家自行安利，这里就不做赘述了。</p>
<h1 id="6-异常不监控"><a href="#6-异常不监控" class="headerlink" title="6.异常不监控"></a>6.异常不监控</h1><p>当系统抛出异常被捕获后，很多同学只是通过日志记录了一下异常信息，但是并没有通过监控系统记录异常。这样带来的隐患就是我们没法在第一时间感知系统异常，只能是影响到其他监控了才会有所体现，但这样就只能靠运气了。如果被影响的监控比较敏感，或许很快就会有告警；但是如果被影响的监控不敏感，或者压根没开告警，那么你就呵呵了……</p>
<h1 id="7-堆外不清理"><a href="#7-堆外不清理" class="headerlink" title="7.堆外不清理"></a>7.堆外不清理</h1><p>在某些业务场景下，我们可能需要使用DirectByteBuffer分配字节缓冲区，或者使用MappedByteBuffer做内存映射，那么我们不可避免地需要使用堆外内存。DirectByteBuffer对象在创建过程中会先通过Unsafe接口直接通过os::malloc来分配内存，然后将内存的起始地址和大小存到DirectByteBuffer对象里，这样就可以直接操作这些内存。我们dump内存时可能会发现DirectByteBuffer对象很小，但是其实它后面可能关联了一个非常大的堆外内存，因此我们通常称之为“冰山对象”。这些内存只有在DirectByteBuffer回收掉之后才有机会被回收，因此如果这些对象大部分都移到了old，但是一直没有触发CMS GC或者Full GC，那么悲剧将会发生，因为你的物理内存被他们耗尽了，因此为了避免这种悲剧的发生，通过-XX:MaxDirectMemorySize来指定最大的堆外内存大小，当使用达到了阈值的时候将调用System.gc来做一次full gc，以此来回收掉没有被使用的堆外内存。</p>
<p>另外，当前我们的使用的服务框架、第三方组件，很多都是基于netty、mina这种NIO框架实现网络调用，而这些NIO框架基本都在使用堆外内存。而我们知道，堆外内存是无法通过JVM的垃圾回收器回收的，只能通过System.gc()来回收。但是很多同学在设置JVM参数的时候，往往选择拷贝已有的配置，而忽略了一个很重要的参数DisableExplicitGC，这个参数的意思是禁用显式GC，也就是使System.gc()失效。如果我们在jvm参数中配置了-XX:+DisableExplicitGC，那么带来的后果就是进入到老年代的堆外内存无法被回收掉，最终导致OOM。</p>
<p>至此，一日丧命散的其中毒虫就介绍完了。如果想要活得久，请远离这七条毒虫，哈哈。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fengfu.io/2016/10/24/让你变成优秀程序员的几个小习惯/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宁静·致远">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宁静·致远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/24/让你变成优秀程序员的几个小习惯/" itemprop="url">让你变成优秀程序员的几个小习惯(转)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-24T19:39:22+08:00">
                2016-10-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2016/10/24/让你变成优秀程序员的几个小习惯/" class="leancloud_visitors" data-flag-title="让你变成优秀程序员的几个小习惯(转)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>译文链接：<a href="http://www.codeceo.com/article/habits-to-be-better-programmer.html" target="_blank" rel="external">http://www.codeceo.com/article/habits-to-be-better-programmer.html</a></p>
<p>英文原文：<a href="https://www.quora.com/What-little-habits-made-you-a-better-software-engineer?srid=ieH" target="_blank" rel="external">What little habits made you a better software engineer?</a></p>
<p>翻译作者：<a href="http://www.codeceo.com/" target="_blank" rel="external">码农网</a> – 小峰</p>
<p>作者Jeff Standen，有着21+年经验的软件开发者。</p>
<p><strong>首先开发spike解决方案</strong>——这是我早期敏捷/极限编程所养成的习惯之一。spike解决方案是一次性原型，可以帮助你在投入大量时间和精力之前验证你是否走对路。</p>
<p>区别就在于原型，因为你遵循这样一个规则，在你完成研究之后，你最终会扔掉“spike”代码。所以允许你偷工减料，迅速行动，因为它不会出现在产品或代码审查中。</p>
<p>此方法有助于迅速发现设计的哪些部位尚不明确，而不必过早地尝试架构或设计决策。</p>
<p><strong>致力于小而连贯代码块的版本控制</strong>——通过类似CVS/Subversion，每次提交都直接发送到服务器。做部分文件的提交并不简单。</p>
<p>随着Git的出现，只提交较大文件的若干行代码变得很容易，并且可以在push到远程代码仓库之前先本地rebase/merge提交。</p>
<p>有一次，我在工作于更大功能的时候，采用了小型增量提交，我的工作效率直线上升。这样做能够清空我的大脑以便于面对更重要的事情。</p>
<p><strong>经常写代码</strong>——最近，我正工作于：一个基于Web的企业协作和自动化平台（PHP / MySQL），一个基于云的实时指标聚合器和使用循环哈希（Node.js/ Redis）的API，一个面向iOS app商店（Swift/ SpriteKit）的棋盘游戏，专门的基于URL的cronjob可替代基于web的SaaS服务（JAVA），等等。</p>
<p>用过大量框架和语言有助于我的抽象和算法思维。</p>
<p>我从工具，如Eclipse RCP、Tapestry和Hibernate中学到了很多伟大的经验教训，并用到我的PHP项目里。尤其是在2000年初，在有Java特征的企业生态系统用于PHP存在之前。我从Unity3d/C＃学到了很多关于网络和面向消息的架构。</p>
<p>如果我只坚持单一平台和社区的话，就永远不会知道这些概念。</p>
<p><strong>编写简单的代码</strong>——我以前习惯于写复杂的代码以作为对自己的挑战。而现在的挑战是要编写优雅且简单的代码——到一种每个人都觉得他们也能做到的地步（即使他们不能）。简单代码通常来自于若干次复杂代码的迭代。</p>
<p>引用Antoine de Saint Exupéry的话就是：“不是没有什么可添加，而是没有什么可消减的时候，才算是达到了完美。”</p>
<p>这也使得我们在长时间休止之后返回项目，以及鼓励其他人参与进来变得容易多了。</p>
<p><strong>最后优化</strong>——我们很容易掉入试图比用户或计算机更聪明，并且预优化各种边缘情况的陷阱。关注帕累托法则（80％的效果来自于20％的工作）。写代码，运行代码，当必要的时候专注于最大的瓶颈。这也支持保持代码库的简单。</p>
<p>说“不要首先优化代码”并不意味着“编写粗糙的代码”。代码总是应该精益和优雅，没有必要画蛇添足，不要将一整天的时间用在挤压剩下的10％，但其实已经能够工作良好的一些东西上。不但工作效率会下降，而且还会引进更多复杂性，解决方案变得不那么可归纳，等等。</p>
<p><strong>着眼于“最重要的事情优先”</strong>——总是有一些项目领域比其他的更有趣或更具挑战性。工作于那些有趣的东西总是比工作于那些必要的东西更有诱惑。</p>
<p>在攻克重要部分时，将有趣部分作为一种调剂，也就是说，两者都做一点也是可以。</p>
<p>因此，光从这一点上说，将大的问题分解成小问题的理念是不言自明的。每个人都懂。所以，我会通过计分若干“quick wins”来开启我的一天，这能让我更有冲劲和更专注（“quick wins”可以是任何东西，包括有趣又小型的挑战），然后我会首先冲向“最重要的事情”。</p>
<p><strong>了解全栈</strong>——当我刚开始干这一行的时候，没有什么比等别人做完他们那部分东西，然后我才能继续我那部分工作更糟糕的了（设计师，后端人员，前端人员，数据库人员，服务器人员，等等）。</p>
<p>于是，当我2000年创办自己的软件开发公司的时候，我做了一个明智的决定，那就是涉猎全栈。我知道我不可能擅长所有东西，也不可能是最后唯一对所有一切负责的人，但我想要做终端到终端的原型，因为我没有耐心看过程。</p>
<p>每当我需要的东西触碰到我不懂的领域时，我会研究它。于是乎，我学会了服务器管理，数据库管理，设计，前端/后端开发，云架构等。</p>
<p>通过了解其他领域是做什么的，我才能写出包含它们需要的代码。</p>
<p>当然，其中的一些要点似乎并不是所谓的“小习惯”，但我向你保证，它们是小变化历经20年时间导致的结果。重要的行为变化并没有意义，更多的是关于我是如何频繁地练习这门技术（在过去10年时间中每年大概4000-5000个小时）。</p>
<p>所以，我的做法更像是去回答这个问题：“什么样的小习惯会导致更糟糕的软件和低效的生产力？”，然后反过来。</p>
<h1 id="作者Ed-Prentice，软件工程师"><a href="#作者Ed-Prentice，软件工程师" class="headerlink" title="作者Ed Prentice，软件工程师"></a>作者Ed Prentice，软件工程师</h1><p>时间是宝贵的，所以要尽可能地节省时间。尽可能自动化。一旦时间成为一种商品，那么你可以实现下一个伟大的创新。</p>
<p>使用功能强大的IDE（如vim），并将其配置能为你做尽可能多的事情。力争单个命令Build/Test/Deploy/Run。</p>
<p>如果你发现自己常做某件事情，那么可以让它们在一个按键下发生，或者一次点击下发生。或者更好的是，让它们自动发生。</p>
<p>了解键盘快捷键和UNIX命令行。几乎所有的IDE都可以让你运行复杂的编译命令，甚至任意的终端命令——不但强大，并且可以为你节省大量的时间。</p>
<p>提问题，然后提更多的问题。如果有什么你不明白的事情发生了，那就问为什么。然后走开，研究替代方案，并提出来。一直问问题直到你可以详细地给下一个问为什么的开发人员解释。我时常感到奇怪为什么会有这么多开发人员不知道为什么，仅仅是因为觉得“它总是/曾是这样”。</p>
<p>通过提供更好的替代解决方案挑战现状——并且制定步骤实现。如果你的测试不完整，或每天/每周运行一次——那么成为本地的Continuous Integration大师——目的是为了有利于你的团队，并实现它。一旦你使用它并且它可以帮助你更好工作的话，那么让你的团队也使用它。</p>
<p>不要只是挑战别人，挑战自己。从来没有写过web应用程序？那么写一个。从未用过Python？用Python劫持无人飞行器。</p>
<p>拥有一些东西。创造一些东西。没有必是非要做技术项目，可以是一个事件，例如聚会或编程马拉松，也可以是一个游戏，一个网站，一个博客。</p>
<p>教一些东西。Java，公开演讲，写作，下棋，vim，网球。</p>
<p>成为一个杰出的人。拿到一个垃圾类/组件？修复好它。编写代码的正确途径。不在代码中走捷径。做出明智的决策，向你周围的人说明为什么你要做这个决定的利弊。总是改善代码。制定不需要花费1小时的待办事项表？Just Do It。</p>
<p>浏览你熟悉的Stack Exchange的话题——例如你喜欢的语言。当你发现什么新的东西的时候，尽快末位淘汰相关知识。知道C语言？什么是分支预测？这篇文章会告诉你——你要做的就是学习。</p>
<p>浏览你不熟悉的Stack Exchange的话题——好好学习，天天向上。</p>
<p>学会沟通。书面文字，呈现展示，解决问题，小却激烈的小项目，大型团队，小型团队。</p>
<p>文档化你的所有过程。你可以回头查阅你为什么做这些事情，以及依赖原先的解决方案去解决碰到的相似问题。这还有助于捕捉你可能会忘记的思维过程和关键的信息片段。我经常通过日志来回顾前几天的工作。</p>
<p>在你写之前文档化你的代码。使用系统图，类层次结构，流程图表，以展示说明你的代码将如何工作。如果有人提出建议——是的，他们会提出来的——那么你可以进行修改，这比已经写好了代码再去修改要容易得多。这是另一个我很少看到有人会做但却有着最负面影响的事情。</p>
<p>特定化。为新的东西制作图表，向大家展示。收集尽可能多的细节。确保每个人同意这个图表。如果有人提出了建议，那就补充/添加更正到图表。保持图表更新。</p>
<p>知道潜意思的偏见和男性特权。了解你是哪种MBTI和人格类型，并且更重要的是，要知道如何与其他性格类型更好地互动。了解情商。每个人都是不一样的，你需要知道如何与他们进行最有效和最有建设性的交互。</p>
<p>定期为团队做一些事情。带饼干。教魔术。培育一点文化，并鼓励其他人也这样做。赞美其他人的贡献。一支有凝聚力的团队是很难被击败的。</p>
<p>学习如何与人合作。我个人非常喜欢《The Pragmatic Programmer》的“stone snop”。</p>
<p>理解和使用别人的代码。如果你正在实现自己的XML解析器或或csv阅读器或git hook，那么你就是在重新发明轮子。</p>
<p>一旦你写了代码，并且它是有效的，通过测试的，那么回过头去整理一下吧。重新运行测试。再整理。每个类都应该有单一的职责，每个函数都应该只做一件事情。在大多数情况下，函数应该小于20行代码的长度。使用自文档的函数名和变量名。花时间整理你的代码以后将会10倍地回报给你和你的团队。</p>
<p>参与其中。承担责任。如果事情有不对的地方，那就解决它。如果最后期限临近了又想出了一个解决方案，那让其他人尽快知道。任何人都可以做到这一点，即使是最初级的开发人员。这要求对项目的蓝图，方向和截止期限有着大局观的认识——参与进来。保存好每天的工作内容！</p>
<p>和团队分享学到的经验教训（在适当的时候）。指出Java中finally块内部抛出异常的时候发生了什么？和大家一起分享。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fengfu.io/2016/08/23/接口文档参考模板/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宁静·致远">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宁静·致远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/23/接口文档参考模板/" itemprop="url">接口文档参考模板</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-23T09:50:26+08:00">
                2016-08-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2016/08/23/接口文档参考模板/" class="leancloud_visitors" data-flag-title="接口文档参考模板">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>虽然提供了在线接口参数的查看，但在和客户端对接过程中，我们作为后台开发，还是需要人工提供接口文档给客户端的，这里提供一个接口文档编写的模板，以供参考，并且以我们熟悉的?service=User.GetBaseInfo为例说明如何编写高效的文档。  </p>
<p> <em>温馨提示：斜体字表示是注释说明</em>。  </p>
<p>##功能说明<br><em>对接口功能的简单说明。</em><br>获取用户的基本信息。</p>
<p>##接口URL<br><em>请求的相对链接和当前接口级参数，通常为?service=XXX.XXX + 公共接口参数。</em><br>/demo/?service=User.GetBaseInfo  </p>
<h2 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a><a href="http://phalapi.oschina.mopaas.com/Public/demo/checkApiParams.php?service=User.GetBaseInfo" target="_blank" rel="external">参数说明</a></h2><p><em>对当前接口级参数的说明，建议使用在线接口参数查询工具，但以下的参数说明也是需要的。</em>  </p>
<table>
<thead>
<tr>
<th>参数</th>
<th>名字</th>
<th>是否必须</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>userId</td>
<td>用户ID</td>
<td>是</td>
<td>表示用户的ID</td>
<td>&amp;user_iduser_id=1</td>
</tr>
</tbody>
</table>
<p>##返回参数<br><em>对当前接口级返回参数的说明，即对{“ret”:返回状态码,”data”:”应该业务数据”,”msg”:”错误提示”}中的data部分进行说明。</em>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;ret&quot;: 200,</div><div class="line">    &quot;data&quot;: &#123;</div><div class="line">        &quot;code&quot;: 0,  //code=0表示正确获取用户信息，code=1时表示用户不存在</div><div class="line">        &quot;msg&quot;: &quot;&quot;,   //业务提示文案</div><div class="line">        &quot;info&quot;: &#123;  //仅当code=0的情况下非空且有用户信息</div><div class="line">            &quot;id&quot;: &quot;1&quot;,  //用户ID   </div><div class="line">            &quot;name&quot;: &quot;dogstar&quot;,  //用户名</div><div class="line">            &quot;from&quot;: &quot;oschina&quot;  //用户来源</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    &quot;msg&quot;: &quot;&quot;</div><div class="line">&#125;</div><div class="line">```  	  </div><div class="line"></div><div class="line">  </div><div class="line">##示例</div><div class="line"> _至少应包括成功示例，失败示例可选_     </div><div class="line">  </div><div class="line">###成功示例</div><div class="line">请求：</div></pre></td></tr></table></figure>
<p><a href="http://phalapi.oschina.mopaas.com/Public/demo/?service=User.GetBaseInfo&amp;user_iduser_id=1" target="_blank" rel="external">http://phalapi.oschina.mopaas.com/Public/demo/?service=User.GetBaseInfo&amp;user_iduser_id=1</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">返回：</div></pre></td></tr></table></figure></p>
<p>{<br>    “ret”: 200,<br>    “data”: {<br>        “code”: 0,<br>        “msg”: “”,<br>        “info”: {<br>            “id”: “1”,<br>            “name”: “dogstar”,<br>            “from”: “oschina”<br>        }<br>    },<br>    “msg”: “”<br>}<br>```</p>
<hr>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fengfu.io/2016/08/22/晋级Review归来话答辩/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宁静·致远">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宁静·致远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/22/晋级Review归来话答辩/" itemprop="url">晋级Review归来话答辩</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-22T09:50:26+08:00">
                2016-08-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2016/08/22/晋级Review归来话答辩/" class="leancloud_visitors" data-flag-title="晋级Review归来话答辩">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>每半年一次的晋级季结束了，这次自己团队的同学有参加晋级的，需要帮他们过PPT以及预演，同时也参加了其他同学的晋级答辩。在这过程中发现了很多问题，觉得有必要写出来总结一下了，以帮助同学们写好PPT和做好答辩工作。</p>
<h1 id="PPT中的常见问题"><a href="#PPT中的常见问题" class="headerlink" title="PPT中的常见问题"></a>PPT中的常见问题</h1><h2 id="1-没有大纲"><a href="#1-没有大纲" class="headerlink" title="1.没有大纲"></a>1.没有大纲</h2><p>写PPT跟上学的时候写作文有点类似，我们需要先把大纲列出来，否则写出来的内容就容易有缺失，内容也不连贯。这样的PPT在讲的时候也会让你很纠结，听众更难受。</p>
<h2 id="2-前后不连贯"><a href="#2-前后不连贯" class="headerlink" title="2.前后不连贯"></a>2.前后不连贯</h2><p>一个好的PPT，前后之间应该有关联，不应该彼此孤立。很多时候，我们需要通过前面的片子来引出后面的内容，也就是俗话说的“抛砖引玉”。典型的场景比如：通过项目特点/难点，引出后面的挑战/遇到的问题，最后引出如何解决。这样下来，整个PPT就会顺畅很多。</p>
<h2 id="3-重要内容有遗漏"><a href="#3-重要内容有遗漏" class="headerlink" title="3.重要内容有遗漏"></a>3.重要内容有遗漏</h2><p>此处说的重要内容是指契合公司文化的内容，比如去哪儿来说，推崇工程师文化，那么你平时的工作中，通过工具提升工作效率，或者开发一些组件这样的事情就比较值得拿出来说。但是有些人可能觉得这些事情不重要而忽略，那么就是一种损失。</p>
<p>其实任何工作都是这样，你如果只是做好本职工作（自扫门前雪），这本身就是一个基本要求，你做好是应该的。但是如果你对自己要求高一些，站在整个团队的角度，或者站在整个公司的角度看待问题或者做一些事情，那么这个事情的高度就会更高一些，做出的成绩可能也会更大。所以从这一点来讲，作为工程师，在做事的态度和方式上，也应该立足高远才好。</p>
<h2 id="4-文字太多"><a href="#4-文字太多" class="headerlink" title="4.文字太多"></a>4.文字太多</h2><p>一页PPT最好不要超过30字，这是一个基本原则，希望能够尽量遵守。因为人是视觉动物，当看到密密麻麻的字的时候，首先会选择放弃。我们来看一下下面这张PPT，看到的第一眼你是什么感觉？<br><img src="https://img.alicdn.com/imgextra/i2/2657627814/TB2BPAMaxmJ.eBjy0FhXXbBdFXa_!!2657627814.png" alt=""></p>
<p>再来看这张：</p>
<p><img src="https://img.alicdn.com/imgextra/i4/2657627814/TB2ta.PaCqJ.eBjy1zbXXbx8FXa_!!2657627814.png" alt=""></p>
<p>相比上一张，是不是清爽了很多？</p>
<p>另外，关于PPT的文字，给大家的建议是用微软雅黑，微软雅黑无论在表现汉字还是字母数字都比较圆润，看起来比较舒服。尽量不要用宋体，因为宋体边缘较窄，会给人带来视觉上的沉重感。</p>
<h2 id="5-没有图表"><a href="#5-没有图表" class="headerlink" title="5.没有图表"></a>5.没有图表</h2><p>俗话说，一图胜千言。作为工程师，我们可以通过架构图来描述对系统的理解，通过流程图来描述对业务/流程的理解，通过类图来描述代码实现。通过监控图/表格来描述结果，这样你的PPT内容就会更加丰满，形式也更加漂亮。</p>
<h2 id="6-动画太过花哨"><a href="#6-动画太过花哨" class="headerlink" title="6.动画太过花哨"></a>6.动画太过花哨</h2><p>既然我们是工程师，不是视觉设计师，所以那些花哨的动画就免了吧，毕竟这不是我们的专长，简单的淡出效果就挺好了。当然，如果你想要用动画来描述一些状态流转之类的，那么你可以去花点时间。</p>
<h1 id="答辩时的常见问题"><a href="#答辩时的常见问题" class="headerlink" title="答辩时的常见问题"></a>答辩时的常见问题</h1><h2 id="1-没有事先调试好投影"><a href="#1-没有事先调试好投影" class="headerlink" title="1.没有事先调试好投影"></a>1.没有事先调试好投影</h2><p>经常看见有的同学到答辩的时候才去调试投影仪，出了问题之后不得不借别人的电脑。这种事情以后还是要避免，其实只要提前做一下调试就可以了，花不了几分钟时间，但最起码可以避免现场糗个大的。</p>
<h2 id="2-PPT没有预演，直接开讲"><a href="#2-PPT没有预演，直接开讲" class="headerlink" title="2.PPT没有预演，直接开讲"></a>2.PPT没有预演，直接开讲</h2><p>这也是很多人容易犯的错误。我们在写PPT的时候，可能会觉得思如泉涌，PPT很顺畅就做完了。但其实做完了是一回事，你能顺畅地讲出来又是一回事了，可能那时候你会发现自己的PPT怎么做的那么烂，连舌头都不灵活了…… 所以最好的方式是：写完PPT之后先给自己讲两遍，自己讲顺畅了再去给别人讲。</p>
<h2 id="3-没有自我介绍"><a href="#3-没有自我介绍" class="headerlink" title="3.没有自我介绍"></a>3.没有自我介绍</h2><p>陌生人见面总是要打个招呼，做个自我介绍吧，有些同学一上来就直奔主题，一来容易搞得自己紧张，二来显得有点不礼貌。</p>
<h2 id="4-紧张"><a href="#4-紧张" class="headerlink" title="4.紧张"></a>4.紧张</h2><p>这是很多人都会出现的问题，有的人紧张的连声调都变了。针对这个问题，我的建议是：1.开始讲PPT前，先做一个深呼吸；2. 站着讲。站着讲的一个好处是，你可以通过肢体动作调节自己的情绪和节奏。</p>
<h2 id="5-代码没好好准备"><a href="#5-代码没好好准备" class="headerlink" title="5.代码没好好准备"></a>5.代码没好好准备</h2><p>很多同学只重视PPT，却没有认真准备代码，结果review代码的时候被虐，当然最终的结局也就不乐观。</p>
<p>最后，给大家推荐一本书，《<a href="https://item.jd.com/11697566.html" target="_blank" rel="external">乔布斯的魔力演讲</a>》，相信这本书可以帮助你提高PPT及演讲能力。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fengfu.io/2016/08/12/读书笔记-微服务设计-建模/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宁静·致远">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="宁静·致远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/12/读书笔记-微服务设计-建模/" itemprop="url">读书笔记:微服务设计-建模</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-12T20:52:17+08:00">
                2016-08-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2016/08/12/读书笔记-微服务设计-建模/" class="leancloud_visitors" data-flag-title="读书笔记:微服务设计-建模">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-什么样的服务是好服务"><a href="#1-什么样的服务是好服务" class="headerlink" title="1.什么样的服务是好服务"></a>1.什么样的服务是好服务</h1><h2 id="1-高内聚"><a href="#1-高内聚" class="headerlink" title="1.高内聚"></a>1.高内聚</h2><p>  说到高内聚，还是得提一下单一职责原则(Single Responsibility Principle)。在软件编程中，谁也不希望因为修改了一个功能导致其他的功能发生故障，而避免出现这一问题的方法便是遵循单一职责原则。<br>  那如何来做到服务的高内聚呢？首先要确定问题域的边界，其次将相同边界的相关行为放在一个地方。</p>
<h2 id="2-低耦合"><a href="#2-低耦合" class="headerlink" title="2.低耦合"></a>2.低耦合</h2><p>  使用微服务最重要的一点是：能够独立修改及部署单个服务而不需要修改系统的其他部分。</p>
<h1 id="2-限界上下文"><a href="#2-限界上下文" class="headerlink" title="2.限界上下文"></a>2.限界上下文</h1><p>  限界上下文(bounded context)这个概念来自于Eric Evans的《领域驱动设计》一书，Eric认为：一个给定的领域包含多个限界上下文，每个限界上下文中的东西分成2个部分，一部分不需要与外界通信，另一部分则需要。每个上下文都有明确的接口，该接口决定了它会暴露哪些模型给其他的上下文。当然本文作者更喜欢这个定义：一个由显示边界限定的特定职责。如果你想要从一个限界上下文中获取信息，或者向其发起请求，需要使用模型和它的显示边界进行通信。</p>
<p>  应该共享特定的模型，而不应该共享内部表示，这样就可以避免潜在的紧耦合风险。</p>
<p>  一般来讲，微服务应该清晰地和限界上下文相对应。</p>
<h1 id="3-业务功能"><a href="#3-业务功能" class="headerlink" title="3.业务功能"></a>3.业务功能</h1><p>  在思考组织内的限界上下文时，不应该从共享数据的角度来考虑，应该从这些上下文能够提供的功能来考虑。首先要问自己：这个上下文是做什么用的，然后再考虑它需要什么样的数据。</p>
<p>  建模服务时，应该将这些功能作为关键操作提供给其协作者。</p>
<h1 id="4-逐步划分上下文"><a href="#4-逐步划分上下文" class="headerlink" title="4.逐步划分上下文"></a>4.逐步划分上下文</h1><p>  先识别粗粒度上下文，然后当发现合适的缝隙后，再进一步划分出那些嵌套的上下文。</p>
<p>  对于嵌套上下文，一种方式是嵌套上下文不直接对外可见，另外一种方式是限界上下文被提升到顶层上下文的层次。这两种方式都具有其合理性，具体还要看组织机构的划分。比如服务A、服务B、服务C分别由不同团队维护，那么可能大家倾向于成为顶层上下文；如果由一个团队维护，那么嵌套架构会更合理。另外，从测试的角度，嵌套式上下文更便于测试，毕竟它对外暴露的服务更少。</p>
<p>另外一本书推荐：Vaughn Vernon的<a href="http://item.jd.com/11423256.html" target="_blank" rel="external">《实现领域驱动设计》</a>，这本书貌似卖得更好。</p>
<p><em>图片说明：稻城-亚丁</em></p>
<p>稻城—亚丁因其独特而原始的自然环境、美丽风景被誉为“最后的香格里拉”，景点分为稻城和亚丁两部分，有雪山、冰川、峡谷、森林、草甸、湖泊等景观。除了珍珠海、牛奶海等冰川湖泊，稻城最令人向往的是驰名藏区的雪域神峰——稻城神峰，它由仙乃日、央迈勇、夏诺多吉三座神山组成，均位于亚丁自然保护区。人们把仙乃日比作大佛、把央迈勇比作少女，将夏诺多吉当作少年，三座神山就像三尊圣灵，这里也就成了藏民心中朝圣的圣地。</p>
<p><img src="https://img.alicdn.com/imgextra/i1/2657627814/TB29IAuXaryQeBjSszdXXaL.XXa_!!2657627814.jpg" alt="稻城-亚丁"></p>
<p><img src="https://img.alicdn.com/imgextra/i4/2657627814/TB24zkuXabyQeBjy1XbXXa9yXXa_!!2657627814.jpg" alt="稻城-亚丁"></p>
<p><img src="https://img.alicdn.com/imgextra/i3/2657627814/TB2GWAvXhHxQeBjy1zjXXa5YVXa_!!2657627814.jpg" alt="稻城-亚丁"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="宁静·致远" />
          <p class="site-author-name" itemprop="name">宁静·致远</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">42</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">宁静·致远</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Gemini
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("pq7j7M6jaVzlRAhO3VhuFy1O-gzGzoHsz", "Fqlk4xsApzNKqC5HV87nMkix");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

</body>
</html>
