
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>宁静·致远</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="宁静·致远">
<meta property="og:url" content="http://fengfu.io/index.html">
<meta property="og:site_name" content="宁静·致远">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="宁静·致远">
  
    <link rel="alternative" href="/atom.xml" title="宁静·致远" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">宁静·致远</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="fengfu.io">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main">
  
    <article id="post-Linux性能分析工具" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/13/Linux性能分析工具/" class="article-date">
  <time datetime="2017-06-13T09:28:33.000Z" itemprop="datePublished">2017-06-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/13/Linux性能分析工具/">Linux性能分析工具</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://img.alicdn.com/imgextra/i2/2657627814/TB2Fpf7w0FopuFjSZFHXXbSlXXa_!!2657627814.png" alt=""></p>
<p><img src="https://img.alicdn.com/imgextra/i1/2657627814/TB2oKsaw5RnpuFjSZFCXXX2DXXa_!!2657627814.png" alt=""></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://fengfu.io/2017/06/13/Linux性能分析工具/" data-id="cj3vdyj18000fgcx0i1buy7xl" class="article-share-link" data-share="baidu" data-title="Linux性能分析工具">分享到</a>
      

      
        <a href="http://fengfu.io/2017/06/13/Linux性能分析工具/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/性能/">性能</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-使用JRebel远程热部署Class" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/11/使用JRebel远程热部署Class/" class="article-date">
  <time datetime="2017-04-11T13:08:09.000Z" itemprop="datePublished">2017-04-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/11/使用JRebel远程热部署Class/">使用 jrebel 远程部署开发环境的 dubbo 服务</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文转自<a href="http://wulfric.me/2017/04/jrebel/" target="_blank" rel="external">http://wulfric.me/2017/04/jrebel/</a> ，如果转载请尊重原作者版权。</p>
<blockquote>
<p>声明: 本文采用 <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" title="姓名标示-非商业性-禁止改作4.0国际" target="_blank" rel="external">CC BY-NC-ND 4.0</a> 授权。</p>
</blockquote>
<figure><a class="post-image" rel="post-image" href=""><img src="https://zeroturnaround.com/wp-content/uploads/2011/02/jrebel-dl.png" alt="jrebel " title="jrebel"></a><br></figure>

<p>在开发 java 程序的时候，如果改动非常频繁，每次改动都要重新打包、部署，对于很重的应用（比如本文所说的 dubbo provider 服务），这样反复的流程十分消耗精力和热情。我们需要一个工具，当代码作改动之后能够立即看到效果。Java 在 1.4 的时候引入了 HotSwap 技术，允许调试者使用同一个类标识来更新类的字节码。这意味着所有对象都可以引用一个更新后的类，并在它们的方法被调用的时候执行新的代码，这就避免了无论何时只要有类的字节码被修改就要重载容器的这种要求<sup id="fnref:hotswap-jrebel"><a href="#fn:hotswap-jrebel">1</a></sup>。不幸的是，这种重定义仅限于修改方法体—除了方法体之外，它既不能添加方法或域，也不能修改其他任何东西。</p>
<p>和 PHP 这样的脚本语言不一样，Java 部署是一个令人心烦的问题。一个运行中的 Java 程序相当于一辆在公路上奔跑的汽车，而 HotSwap 技术只能让你更换坐垫，但是让你想要更换轮胎的时候，HotSwap 就帮不上忙了，这个时候你只能停下来，换掉轮胎，再重新启动。而对于 PHP 来说，每个请求都会新开一个进程加载所有的 .php 文件编译和执行，所以不存在这个问题。运行 PHP 程序相当于给静止的汽车拍照，你大可以换完轮胎之后再拍照，这没有任何不良影响。（这个比喻可能不太恰当，却很有趣：在比喻中，静态的语言看起来是运动的，而动态语言看起来是静止的）</p>
<p><a href="https://zeroturnaround.com/software/jrebel/" target="_blank" rel="external">JRebel</a> 是 java 的热部署插件，它监控已编译的 .class 文件，只要有变动，就立即更新在部署好的应用上，能够实现实时查看代码变化的功能。</p>
<figure><a class="post-image" rel="post-image" href=""><img src="https://zeroturnaround.com/wp-content/uploads/2016/11/JR_devcycle_2016_c.png" alt="skip build, package and deploy" title="skip build, package and deploy"></a><br><br><figcaption>skip build, package and deploy</figcaption><br><br></figure>

<p>HotSwap 是工作在虚拟机层面上，且依赖于 JVM 的内部运作，JRebel 用到了 JVM 的两个显著的功能特征—抽象的字节码和类加载器。类加载器允许 JRebel 辨别出类被加载的时刻，然后实时地翻译字节码，用以在虚拟机和可执行代码之间创建另一个抽象层<sup id="fnref:hotswap-jrebel:1"><a href="#fn:hotswap-jrebel">1</a></sup>。这种技术也应用在 zeroturnaround 家其他的工具，比如 xrebel。</p>
<p>如果继续使用上面的比喻，JRebel 相当于在汽车运行过程中，先额外生成一个轮胎，然后以迅雷之势替换掉目标轮胎—汽车不需要停止装载和再启动。</p>
<h2 id="安装和使用"><a href="#安装和使用" class="headerlink" title="安装和使用"></a>安装和使用</h2><p>JRebel 的安装参照官网即可，我是直接在 Intellij 的插件中心安装的，速度比较慢，插件也比较大，挂了代理才下载完成。下载完毕重启 IDE 即可使用。</p>
<p>JRebel 是收费插件，第一次打开的时候需要激活，网上有各种神奇教程可以参考。其实这个插件官方提供了免费的激活码，只要需要你注册一个<a href="https://my.jrebel.com/" target="_blank" rel="external">帐号</a>，并关联一个 twitter 或者 facebook 帐号即可。jrebel 需要这个关联帐号的写权限，会定期发送使用统计到你的 timeline，你可以使用一个小号来关联。</p>
<p>安装和激活完毕之后，就可以在 IDE 的配置页看到 JRebel 选项了。</p>
<figure><a href="http://wulfric.qiniudn.com/java/jrebel-preference.png-origin.webp" target="_blank" rel="external"><img src="http://wulfric.qiniudn.com/java/jrebel-preference.png-article.webp" alt="jrebel preference" title="jrebel preference"></a><br><br><figcaption>jrebel preference</figcaption><br><br></figure>

<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>为了能够比较熟悉该插件的使用，建议按照官方教程，先通过 IDE 本地启动，再通过命令行启动，然后尝试部署到远端服务器。</p>
<p>当在 console 窗口观察到这些输出之后，说明应用正确启用了 JRebel 插件。</p>
<pre><code>2017-04-01 16:27:31 JRebel:  #############################################################
2017-04-01 16:27:31 JRebel:
2017-04-01 16:27:31 JRebel:  JRebel Agent 7.0.6 (201703201213)
2017-04-01 16:27:31 JRebel:  (c) Copyright ZeroTurnaround AS, Estonia, Tartu.
2017-04-01 16:27:31 JRebel:
2017-04-01 16:27:31 JRebel:  Over the last 2 days JRebel prevented
2017-04-01 16:27:31 JRebel:  at least 0 redeploys/restarts saving you about 0 hours.
2017-04-01 16:27:31 JRebel:
2017-04-01 16:27:31 JRebel:  JRebel started in remote server mode.
2017-04-01 16:27:31 JRebel:
2017-04-01 16:27:31 JRebel:
2017-04-01 16:27:31 JRebel:  #############################################################
</code></pre><h3 id="IDE-运行"><a href="#IDE-运行" class="headerlink" title="IDE 运行"></a>IDE 运行</h3><p>IDE 运行本地应用最简单。参见<a href="https://zeroturnaround.com/software/jrebel/quickstart/intellij/?run=ide#!/server-configuration" target="_blank" rel="external">官方教程</a>。</p>
<ol>
<li>执行<span class="codespan">mvn clean</span>清空 target 目录；</li>
<li>打开 「View &gt; Tool Windows &gt; JRebel」调出 JRebel Panel 编辑窗，点击「generate rebel.xml」按钮选中需要监控和热部署的模块。因为是本地执行，所以另外一个「generate rebel-remote.xml」 不需要选中；</li>
<li>将以前通过 「Run ‘MyApp’」或者「Debug ‘MyApp’」来运行的命令改成「Run with JRebel ‘MyApp’」或者「Debug with JRebel ‘MyApp’」即可；</li>
<li>修改代码，然后在「Build」菜单下选择合适的构建选项（只构建单个文件/构建模块/构建项目）；</li>
<li>访问接口，查看结果是否实时改变。</li>
</ol>
<h3 id="命令行运行"><a href="#命令行运行" class="headerlink" title="命令行运行"></a>命令行运行</h3><p>在 JRebel 设置页的「Startup」标签中选择「Run locally from command line」， 选择合适的 jvm 和目标环境。我的 dubbo 使用了 netty 部署，所以选择了「Standalone application」，给出的启动参数如下。</p>
<pre><code># agentpath 是必需的，foo.bar.MyApp 是你要运行的程序
java -agentpath:/Users/xxxx/Library/Application Support/IntelliJIdea2017.1/jr-ide-idea/lib/jrebel6/lib/libjrebel64.dylib foo.bar.MyApp
</code></pre><p>P.S.: 注意上面的「Application Support」需要换成「Application\ Support」。</p>
<p>dubbo 一般推荐使用 start.sh 脚本来启动应用，我们编辑 start.sh 文件，在启动的具体位置那里，将「-agentpath:…」添加在 java 后面，大致如下。</p>
<pre><code>java -agentpath:... $JAVA_OPTS $JAVA_MEM_OPTS $JAVA_DEBUG_OPTS -classpath ...
</code></pre><p>各种目标环境的配置方法有着或大或小的区别，请按照自己的目标环境跟着 JRebel 给的配置方案来设置。</p>
<ol>
<li>配置启动参数，如上所述；</li>
<li>选择需要热部署的模块；</li>
<li>执行<span class="codespan">start.sh</span>部署应用；</li>
<li>Run with JRebel ‘MyApp’；</li>
<li>修改代码，构建改动的文件；</li>
<li>访问接口，查看结果是否实时改变。</li>
</ol>
<p>从输出结果可以看到，JRebel 接管了 console。</p>
<h3 id="远程服务器运行"><a href="#远程服务器运行" class="headerlink" title="远程服务器运行"></a>远程服务器运行</h3><p>官方<a href="https://zeroturnaround.com/software/jrebel/quickstart/intellij/?run=remote#!/server-configuration" target="_blank" rel="external">教程1</a>，<a href="https://manuals.zeroturnaround.com/jrebel/remoteserver/intellij.html" target="_blank" rel="external">教程2</a>更好<sup id="fnref:jrebel-doc"><a href="#fn:jrebel-doc">2</a></sup>。</p>
<p>同上，在 JRebel 配置页选择「Run on a remote server」，根据给出的建议配置好启动项。</p>
<pre><code>java -agentpath:... -Drebel.remoting_plugin=true ... -jar ...
</code></pre><p>在 JRebel 配置页添加远程服务器地址，注意要是能够 http 访问的 url 才可以。</p>
<figure><a class="post-image" rel="post-image" href=""><img src="https://manuals.zeroturnaround.com/jrebel/_images/intellij-add-remote-server.png" alt="添加远程服务器" title="添加远程服务器"></a><br></figure>

<p>添加远程服务器</p>
<ol>
<li>配置启动参数和添加远程服务器，如上所述；</li>
<li>选择需要热部署的模块，注意这个时候「generate rebel.xml」和「generate rebel-remote.xml」 两个都要选中；</li>
<li>将包含 rebel.xml 和 rebel-remote.xml 的代码部署到远程服务器。本地打包并上传，或者代码上传并在远程服务器打包都可以；</li>
<li>在远程服务器上<span class="codespan">start.sh</span>启动应用；</li>
<li>修改代码，构建改动的文件；</li>
<li>访问接口，查看结果是否实时改变。</li>
</ol>
<p>P.S.: 教程1似乎有些问题，远端启动应用后，本地不需要再「Run with JRebel ‘MyApp’」了。</p>
<p>P.S.: 在官方教程里，「Run with JRebel ‘MyApp’」和「generate rebel.xml」checkbox 的图标一模一样，注意区分：有的是让你启动，有的是选中。</p>
<p>P.S.: JRebel 对 Spring 的 bean 注入默认就有很好的支持，参见 <a href="https://zeroturnaround.com/software/jrebel/learn/jrebel-spring-integration/" target="_blank" rel="external">JRebel Spring</a>。它可以根据 xml 文件或者注解自动重新装载 bean。还支持动态实时地在 Spring 中添加 bean 和依赖。</p>
<ol>
<li><p>HotSwap 和 JRebel 原理<a href="https://dzone.com/articles/reloading-java-classes-401" target="_blank" rel="external">原文</a>，<a href="http://www.hollischuang.com/archives/598" target="_blank" rel="external">译文</a> <a href="#fnref:hotswap-jrebel">↩</a> <a href="#fnref:hotswap-jrebel:1">↩<sup>2</sup></a></p>
</li>
<li><p>参照官方的<a href="https://manuals.zeroturnaround.com/jrebel/index.html" target="_blank" rel="external">详细使用文档</a>是更好的选择 <a href="#fnref:jrebel-doc">↩</a></p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://fengfu.io/2017/04/11/使用JRebel远程热部署Class/" data-id="cj3vdyj1o0010gcx06mu9k2zs" class="article-share-link" data-share="baidu" data-title="使用 jrebel 远程部署开发环境的 dubbo 服务">分享到</a>
      

      
        <a href="http://fengfu.io/2017/04/11/使用JRebel远程热部署Class/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Spring Xml扩展机制" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/06/Spring Xml扩展机制/" class="article-date">
  <time datetime="2017-03-06T10:41:09.000Z" itemprop="datePublished">2017-03-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/06/Spring Xml扩展机制/">Spring xml扩展机制</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Spring框架从2.0版本开始，提供了基于Schema风格的XML扩展机制，允许开发者扩展最基本的spring配置文件，这样我们就可以编写自定义的xml bean解析器然后集成到Spring IoC容器中。很多支持Spring的框架，比如Dubbo、mybatis都提供了对Spring xml扩展的支持。</p>
<p>Xml扩展大概有以下几个步骤：</p>
<ul>
<li>编写xml schema来描述自定义元素</li>
<li>编写自定义类</li>
<li>编写<code>NamespaceHandler</code>的实现类</li>
<li>编写<code>BeanDefinitionParser</code>实现类</li>
<li>把上述组件注册到Spring</li>
</ul>
<h2 id="编写自定义schema"><a href="#编写自定义schema" class="headerlink" title="编写自定义schema"></a>编写自定义schema</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">xsd:schema</span> <span class="attr">xmlns</span>=<span class="string">"http://www.mycompany.com/schema/product"</span></span></div><div class="line">        <span class="attr">xmlns:xsd</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span></div><div class="line">        <span class="attr">xmlns:beans</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></div><div class="line">        <span class="attr">targetNamespace</span>=<span class="string">"http://www.mycompany.com/schema/product"</span></div><div class="line">        <span class="attr">elementFormDefault</span>=<span class="string">"qualified"</span></div><div class="line">        <span class="attr">attributeFormDefault</span>=<span class="string">"unqualified"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">xsd:import</span> <span class="attr">namespace</span>=<span class="string">"http://www.springframework.org/schema/beans"</span>/&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">"robot"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">xsd:complexType</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">xsd:complexContent</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">xsd:extension</span> <span class="attr">base</span>=<span class="string">"beans:identifiedType"</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">"brand"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> <span class="attr">use</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">										<span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">"type"</span> <span class="attr">type</span>=<span class="string">"xsd:string"</span> <span class="attr">use</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">"height"</span> <span class="attr">type</span>=<span class="string">"xsd:int"</span>/&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">xsd:attribute</span> <span class="attr">name</span>=<span class="string">"weight"</span> <span class="attr">type</span>=<span class="string">"xsd:float"</span>/&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">xsd:extension</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">xsd:complexContent</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">xsd:complexType</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">xsd:element</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xsd:schema</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="编写自定义类"><a href="#编写自定义类" class="headerlink" title="编写自定义类"></a>编写自定义类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Robot</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> String brand;</div><div class="line">	<span class="keyword">private</span> String type;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">int</span> height;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">float</span> weight;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后我们就可以在xml中定义如下的robot元素:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">product:robot</span> <span class="attr">id</span>=<span class="string">"bb8"</span> <span class="attr">brand</span>=<span class="string">"StarWar"</span> <span class="attr">type</span>=<span class="string">"bb8"</span> <span class="attr">height</span>=<span class="string">"100"</span> <span class="attr">weight</span>=<span class="string">"20"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="编写NamespaceHandler"><a href="#编写NamespaceHandler" class="headerlink" title="编写NamespaceHandler"></a>编写NamespaceHandler</h2><p><code>NamespaceHandler</code>用于解析我们自定义名字空间下的所有元素，目前我们要解析上面的<code>product:robot</code>元素。<br><code>NamespaceHandler</code>里面只有3个方法：</p>
<ul>
<li><code>init()</code>会在<code>NamespaceHandler</code>初始化的时候被调用。</li>
<li><code>BeanDefinition parse(Element, ParserContext)</code> - 当Spring遇到一个顶层元素的时候被调用。</li>
<li><code>BeanDefinitionHolder decorate(Node, BeanDefinitionHolder, ParserContext)</code> - 当Spring遇到一个属性或嵌套元素的时候调用.</li>
</ul>
<p>Spring提供了默认实现类<code>NamespaceHandlerSupport</code>，我们只需在init的时候注册每个元素的解析器即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductNamespaceHandler</span> <span class="keyword">extends</span> <span class="title">NamespaceHandlerSupport</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">//遇到robot元素的时候交给RobotBeanDefinitionParser来解析</span></div><div class="line">		registerBeanDefinitionParser(<span class="string">"robot"</span>, <span class="keyword">new</span> RobotBeanDefinitionParser());</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="编写BeanDefinitionParser"><a href="#编写BeanDefinitionParser" class="headerlink" title="编写BeanDefinitionParser"></a>编写BeanDefinitionParser</h2><p>这样在解析xml过程中遇到robot元素时，Spring会交给RobotBeanDefinitionParser来解析。RobotBeanDefinitionParser取出相应的属性然后设置到bean中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RobotBeanDefinitionParser</span> <span class="keyword">extends</span> <span class="title">AbstractSingleBeanDefinitionParser</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="keyword">protected</span> Class&lt;?&gt; getBeanClass(Element element) &#123;</div><div class="line">		<span class="comment">//robot元素对应Robot对象类型</span></div><div class="line">		<span class="keyword">return</span> Robot.class;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doParse</span><span class="params">(Element element, BeanDefinitionBuilder builder)</span> </span>&#123;</div><div class="line"></div><div class="line">		String brand = element.getAttribute(<span class="string">"brand"</span>);</div><div class="line">		String type = element.getAttribute(<span class="string">"type"</span>);</div><div class="line">		String height = element.getAttribute(<span class="string">"height"</span>);</div><div class="line">		String weight = element.getAttribute(<span class="string">"weight"</span>);</div><div class="line"></div><div class="line">		<span class="comment">//把对应的属性设置到bean中</span></div><div class="line">		<span class="keyword">if</span>(StringUtils.hasText(brand))</div><div class="line">			builder.addPropertyValue(<span class="string">"brand"</span>, brand);</div><div class="line"></div><div class="line">		<span class="keyword">if</span>(StringUtils.hasText(type))</div><div class="line">			builder.addPropertyValue(<span class="string">"type"</span>, type);</div><div class="line"></div><div class="line">		<span class="keyword">if</span>(StringUtils.hasText(height))</div><div class="line">			builder.addPropertyValue(<span class="string">"height"</span>, height);</div><div class="line"></div><div class="line">		<span class="keyword">if</span>(StringUtils.hasText(weight))</div><div class="line">			builder.addPropertyValue(<span class="string">"weight"</span>, weight);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="注册handler和schema"><a href="#注册handler和schema" class="headerlink" title="注册handler和schema"></a>注册handler和schema</h2><p>为了让Spring在解析xml的时候能够感知到我们的自定义元素，我们需要把<code>namespaceHandler</code>和xsd文件放到2个指定的配置文件中，这2个文件都位于<code>META-INF</code>目录中。</p>
<h4 id="META-INF-spring-handlers"><a href="#META-INF-spring-handlers" class="headerlink" title="META-INF/spring.handlers"></a>META-INF/spring.handlers</h4><p><code>`spring.handlers` </code>文件包含了xml schema uri和handler类的映射关系，比如：</p>
<blockquote>
<p>http\://www.mycompany.com/schema/product=spring.xml.ext.schema.ProductNamespaceHandler</p>
</blockquote>
<p>这表示遇到<code>http://www.mycompany.com/schema/product</code>命名空间的时候会交给<code>ProductNamespaceHandler</code>来处理。</p>
<p>注意上面的冒号转义。<br>key部分必须和xsd文件中的<code>targetNamespace</code>值保持一致。</p>
<h4 id="META-INF-spring-schemas"><a href="#META-INF-spring-schemas" class="headerlink" title="META-INF/spring.schemas"></a>META-INF/spring.schemas</h4><blockquote>
<p>http\://www.mycompany.com/schema/product.xsd=META-INF/product.xsd</p>
</blockquote>
<h2 id="最后测试下"><a href="#最后测试下" class="headerlink" title="最后测试下"></a>最后测试下</h2><p>写个Spring配置文件products.xml：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> 	<span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">		<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">		<span class="attr">xmlns:my</span>=<span class="string">"http://www.mycompany.com/schema/product"</span></div><div class="line">		<span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></div><div class="line">	        http://www.springframework.org/schema/beans</div><div class="line">	        http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">	        http://www.mycompany.com/schema/product</div><div class="line">	        http://www.mycompany.com/schema/product.xsd"&gt;</div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">product:robot</span> <span class="attr">id</span>=<span class="string">"bb8"</span> <span class="attr">brand</span>=<span class="string">"StarWar"</span> <span class="attr">type</span>=<span class="string">"bb8"</span> <span class="attr">height</span>=<span class="string">"100"</span> <span class="attr">weight</span>=<span class="string">"20"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>测试类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="meta">@ContextConfiguration</span>(locations = &#123; <span class="string">"classpath:products.xml"</span> &#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SchemaTest</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">	<span class="meta">@Qualifier</span>(<span class="string">"bb8"</span>)</div><div class="line">	<span class="keyword">private</span> Robot robot;</div><div class="line"></div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">propertyTest</span><span class="params">()</span> </span>&#123;</div><div class="line">		assertNotNull(robot);</div><div class="line"></div><div class="line">		String brand = robot.getBrand();</div><div class="line">		String type = robot.getType();</div><div class="line">		<span class="keyword">int</span> height = robot.getHeight();</div><div class="line">		<span class="keyword">float</span> weight = robot.getWeight();</div><div class="line"></div><div class="line">		assertEquals(<span class="string">"Brand should be bb8."</span>, <span class="string">"bb8"</span>, brand);</div><div class="line">		assertEquals(<span class="string">"Type should be bb8."</span>, <span class="string">"bb8"</span>, type);</div><div class="line">		assertEquals(<span class="string">"Height should be 100."</span>, <span class="number">100</span>, height);</div><div class="line">		assertEquals(<span class="string">"Weight should be 20."</span>, <span class="number">20</span>, weight);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://blog.csdn.net/cutesource/article/details/5864562" target="_blank">基于Spring可扩展Schema提供自定义配置支持</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://fengfu.io/2017/03/06/Spring Xml扩展机制/" data-id="cj3vdyj1h000qgcx09goij1lg" class="article-share-link" data-share="baidu" data-title="Spring xml扩展机制">分享到</a>
      

      
        <a href="http://fengfu.io/2017/03/06/Spring Xml扩展机制/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-jcmd命令详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/14/jcmd命令详解/" class="article-date">
  <time datetime="2016-12-14T08:28:59.000Z" itemprop="datePublished">2016-12-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/14/jcmd命令详解/">jcmd命令详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>在JDK 1.7及之后的版本，新增了一个命令行工具jcmd。它是一个多功能工具，可以做哪些事情呢？这里先卖个关子，先来看看Oracle官方对jcmd的介绍:</p>
<p><em>The jcmd utility is used to send diagnostic command requests to the JVM, where these requests are useful for controlling Java Flight Recordings, troubleshoot, and diagnose JVM and Java Applications. It must be used on the same machine where the JVM is running, and have the same effective user and group identifiers that were used to launch the JVM.</em></p>
<p>翻译成人话就是：<br>jcmd一个用来发送诊断命令请求到JVM的工具，这些请求对于控制Java飞行记录器、故障排除、JVM和Java应用诊断来说是比较有用的。jcmd必须与正在运行的JVM在同一台机器上使用，并且使用启动该JVM时的用户权限。</p>
<p>jcmd的用法是:<br><code>jcmd &lt;process id/main class&gt; &lt;command&gt; [options]</code></p>
<p>其中command的说明如下：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>help</td>
<td>打印帮助信息，示例：jcmd <pid> help [<command name="">]</pid></td>
</tr>
<tr>
<td>ManagementAgent.stop</td>
<td>停止JMX Agent</td>
</tr>
<tr>
<td>ManagementAgent.start_local</td>
<td>开启本地JMX Agent</td>
</tr>
<tr>
<td>ManagementAgent.start</td>
<td>开启JMX Agent</td>
</tr>
<tr>
<td>Thread.print</td>
<td>参数-l打印java.util.concurrent锁信息，相当于：jstack <pid></pid></td>
</tr>
<tr>
<td>PerfCounter.print</td>
<td>相当于：jstat -J-Djstat.showUnsupported=true -snap <pid></pid></td>
</tr>
<tr>
<td>GC.class_histogram</td>
<td>相当于：jmap -histo <pid></pid></td>
</tr>
<tr>
<td>GC.heap_dump</td>
<td>相当于：jmap -dump:format=b,file=xxx.bin <pid></pid></td>
</tr>
<tr>
<td>GC.run_finalization</td>
<td>相当于：System.runFinalization()</td>
</tr>
<tr>
<td>GC.run</td>
<td>相当于：System.gc()</td>
</tr>
<tr>
<td>VM.uptime</td>
<td>参数-date打印当前时间，VM启动到现在的时候，以秒为单位显示</td>
</tr>
<tr>
<td>VM.flags</td>
<td>参数-all输出全部，相当于：jinfo -flags <pid>, jinfo -flag <vm flag=""> <pid></pid></vm></pid></td>
</tr>
<tr>
<td>VM.system_properties</td>
<td>相当于：jinfo -sysprops <pid></pid></td>
</tr>
<tr>
<td>VM.command_line</td>
<td>相当于：jinfo -sysprops <pid></pid></td>
<td>grep command</td>
</tr>
<tr>
<td>VM.version</td>
<td>相当于：jinfo -sysprops <pid></pid></td>
<td>grep version</td>
</tr>
</tbody>
</table>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://fengfu.io/2016/12/14/jcmd命令详解/" data-id="cj3vdyj1k000tgcx0ud7rabs0" class="article-share-link" data-share="baidu" data-title="jcmd命令详解">分享到</a>
      

      
        <a href="http://fengfu.io/2016/12/14/jcmd命令详解/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-服务化架构-注册与发现" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/23/服务化架构-注册与发现/" class="article-date">
  <time datetime="2016-11-23T06:21:40.000Z" itemprop="datePublished">2016-11-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/23/服务化架构-注册与发现/">服务化架构-注册与发现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="基本功能"><a href="#基本功能" class="headerlink" title="基本功能"></a>基本功能</h1><p>在分布式系统中，服务提供端和消费端彼此不知道对方的存在，因此需要有一种机制来确保消费端能够找到提供端并进行调用。一般来说，提供端需要将自己能够提供的服务信息暴露出来，这样消费端通过检索就能找到自己需要的服务并建立连接进行调用。所以，对于服务提供端来讲，需要具备以下功能：</p>
<ol>
<li>服务注册：将服务信息暴露出来，供消费端查找和使用</li>
<li>取消注册：即注销服务的注册信息</li>
</ol>
<p>同时，对于消费端来说，则需要：</p>
<ol>
<li>服务检索：按一定条件查找服务信息，如按应用、接口、IP等检索</li>
<li>服务订阅：订阅特定的服务，为后面的服务调用和治理做前期准备</li>
<li>取消订阅：取消指定服务的订阅</li>
</ol>
<h1 id="结构组成"><a href="#结构组成" class="headerlink" title="结构组成"></a>结构组成</h1><p>在这种情况下，注册中心的概念就被提了出来。</p>
<p>同时，系统间调用需要能够根据服务的运行状态(如上下线状态、负载、响应时间、网络情况等)而灵活调整调用端与服务端的组合。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://fengfu.io/2016/11/23/服务化架构-注册与发现/" data-id="cj3vdyj27001kgcx0doeh1d3s" class="article-share-link" data-share="baidu" data-title="服务化架构-注册与发现">分享到</a>
      

      
        <a href="http://fengfu.io/2016/11/23/服务化架构-注册与发现/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/架构/">架构</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-服务化架构-组成" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/23/服务化架构-组成/" class="article-date">
  <time datetime="2016-11-23T06:21:06.000Z" itemprop="datePublished">2016-11-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/23/服务化架构-组成/">服务化架构-组成</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="功能结构"><a href="#功能结构" class="headerlink" title="功能结构"></a>功能结构</h1><p>既然是服务化架构，那么肯定会包含服务提供方和调用方，即provider和consumer。那么作为分布式的服务化架构，需要有一个地方存储provider的信息，便于consumer调用，那么这个角色就是注册中心(registry)。</p>
<p>另外，鉴于分布式系统的复杂性和状态多样性，我们需要对provider、consumer、registry进行管理，比如服务依赖管理、权限管理、配置管理、版本管理、流量控制、服务上下线等，那么管理端(administrator)也就成了标配。</p>
<p>所以综上所述，一个完整的分布式服务化架构，应该包含4部分：</p>
<ol>
<li>注册中心Registry</li>
<li>服务提供端Provider</li>
<li>服务消费端Consumer</li>
<li>管理端Administrator</li>
</ol>
<p><img src="https://img.alicdn.com/imgextra/i3/2657627814/TB2_wgncKNOdeFjSZFBXXctzXXa_!!2657627814.png" alt=""></p>
<p>其中，Provider将自己能够提供的服务信息登记到注册中心，同时通过心跳的方式定时更新自己的状态。Consumer从Registry获取可用服务信息后，直接与Provider建立连接进行交互。</p>
<p>这种架构，基于RPC的服务框架如dubbo/dubbox，JSF都是采用这种机制。</p>
<p>另外，一些基于REST的服务框架（比如Spring Cloud）会增加服务路由的组件，也就是说Consumer需要经过服务路由才能请求Provider，这种方式下，其架构就是由5部分组成：</p>
<ol>
<li>注册中心Registry</li>
<li>服务提供端Provider</li>
<li>服务消费端Consumer</li>
<li>服务路由Router</li>
<li>管理端Administrator</li>
</ol>
<p><img src="https://img.alicdn.com/imgextra/i4/2657627814/TB29vfhdNaJ.eBjSsziXXaJ_XXa_!!2657627814.png" alt=""></p>
<p>经由服务路由调用的方式，典型的代表是Spring Cloud，如下图：</p>
<p><img src="https://img.alicdn.com/imgextra/i3/2657627814/TB28lS_dH1J.eBjSszcXXbFzVXa_!!2657627814.jpg" alt=""></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://fengfu.io/2016/11/23/服务化架构-组成/" data-id="cj3vdyj2a001mgcx05yifcw36" class="article-share-link" data-share="baidu" data-title="服务化架构-组成">分享到</a>
      

      
        <a href="http://fengfu.io/2016/11/23/服务化架构-组成/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/架构/">架构</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-服务化架构-前言" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/23/服务化架构-前言/" class="article-date">
  <time datetime="2016-11-23T03:20:00.000Z" itemprop="datePublished">2016-11-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/23/服务化架构-前言/">服务化架构-前言</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>近两年，微服务的概念逐渐火了起来，而docker的出现，更是在微服务的火上浇了一桶油。纯粹地讲，我不太认同微服务的说法。说白了，你还是一个服务，只是因为你的小微，有些地方你需要特别注意，比如高内聚、低耦合，比如团队规模的“两个披萨”原则等。但其实这些原则对于“服务”的世界来讲，早就是普世价值了。</p>
<p>那我们再往前看5年，那时候服务化的架构已经开始在业界崭露头角，比如2011年的时候，阿里把内部的dubbo框架开源了。从当前的标准来看，dubbo并不是一个非常优秀的服务化框架，它有很多缺陷和缺失，但是在5年前，这已经难能可贵了。</p>
<p>上周，在朋友的公司做了一次服务化架构的内训。为了准备这个PPT，特地将服务化框架的体系做了一个梳理，因此决定趁热打铁，写个系列博客进行更进一步的总结。</p>
<p>这个系列的文章，将从以下几个方面进行总结：</p>
<ol>
<li>服务化架构的组成</li>
<li>服务注册与发现</li>
<li>RPC</li>
<li>同步与异步</li>
<li>服务依赖管理</li>
<li>服务链路跟踪</li>
<li>服务路由</li>
<li>服务负载均衡</li>
<li>服务降级</li>
<li>服务限流</li>
<li>服务上下线</li>
<li>服务授权</li>
<li>服务监控与告警</li>
<li>服务版本管理</li>
</ol>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://fengfu.io/2016/11/23/服务化架构-前言/" data-id="cj3vdyj23001dgcx0ml6qn1hy" class="article-share-link" data-share="baidu" data-title="服务化架构-前言">分享到</a>
      

      
        <a href="http://fengfu.io/2016/11/23/服务化架构-前言/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/架构/">架构</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-晋级Review归来话代码有毒" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/27/晋级Review归来话代码有毒/" class="article-date">
  <time datetime="2016-10-27T07:36:55.000Z" itemprop="datePublished">2016-10-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/27/晋级Review归来话代码有毒/">晋级Review归来话代码有毒</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这几天做应届生的转正定级答辩，结束后小黑哥在朋友圈里面发了下面一幅图：</p>
<p><img src="https://img.alicdn.com/imgextra/i3/2657627814/TB2qDgda71M.eBjSZPiXXawfpXa_!!2657627814.jpg" alt=""></p>
<p>并在评论里面说了一句话：网络不超时，堆外不清理，异步不回调，异常不监控。</p>
<p>上面的中毒情况总结得非常不错，这让我想起了《唐伯虎点秋香》里面的一段情节：</p>
<p><img src="https://img.alicdn.com/imgextra/i3/2657627814/TB2Poz0aHaI.eBjy1XdXXcoqXXa_!!2657627814.jpg" alt=""></p>
<p>华夫人对唐伯虎说：一日丧命散是用七种不同的毒虫再加上那鹤顶红提炼七七四十九天而成的，无色无味，杀人于无影无踪。吃了我们一日丧命散的人，一天之内会武功全失，经脉逆流，胡思乱想而至走火入魔，最后啊，会血管爆裂而死。</p>
<p>借着这个情节和小黑哥的中毒，来总结一下代码里面的七种毒虫吧。</p>
<p><img src="https://img.alicdn.com/imgextra/i1/2657627814/TB2Qegea71M.eBjSZPiXXawfpXa_!!2657627814.jpg" alt=""></p>
<h1 id="1-资源不限制"><a href="#1-资源不限制" class="headerlink" title="1.资源不限制"></a>1.资源不限制</h1><p>这是很多码农容易中的毒，典型的症状是：</p>
<h2 id="1-1-缓存不设置最大数量限制"><a href="#1-1-缓存不设置最大数量限制" class="headerlink" title="1.1 缓存不设置最大数量限制"></a>1.1 缓存不设置最大数量限制</h2><p>比如我们使用map实现了一个cache，但是没有设置cache的大小，久而久之你可以想象一下这个cache最终会膨胀到什么程度。当然有同学可能会说我使用的是Guava cache，可以设置数量限制。well done，你再回去看看你的full gc是不是比较频繁，没准是因为这个值太大导致的哟~</p>
<h2 id="1-2-线程池不设置队列大小"><a href="#1-2-线程池不设置队列大小" class="headerlink" title="1.2 线程池不设置队列大小"></a>1.2 线程池不设置队列大小</h2><p>比如我们使用newFixedThreadPool，但是我们没有设置队列的大小，而悲催的是，在java中，线程池队列的默认大小是Integer.MAX_VALUE，我想你自己也能清楚这种情况下会发生什么问题。<br>再比如Executors.newCachedThreadPool，这个接口很多人会用到，但很多用的人都没有仔细想过会不会在某种情况下这里创建出巨多的线程。</p>
<h1 id="2-网络不超时"><a href="#2-网络不超时" class="headerlink" title="2.网络不超时"></a>2.网络不超时</h1><p>这里说的是网络调用的场景不设置超时。</p>
<p>在服务化设计大行其道的今天，我们很多的服务调用都是通过网络调用进行的。设想一下，如果我们调用的某个服务性能低下或者网络异常，长时间没有返回结果，那么调用端线程就会一直阻塞在这里。如果没有使用线程池，那么应用会阻塞在这里。如果使用了线程池，那么线程就会长时间阻塞，最终导致线程池爆掉。</p>
<p>在review代码的时候，这种情况尤其常见，尤其是使用httpclient的时候，各位看官要多加注意哟。</p>
<h1 id="3-自我不保护"><a href="#3-自我不保护" class="headerlink" title="3.自我不保护"></a>3.自我不保护</h1><p>这种情况尤其常见于对外提供接口的情况。对于调用方传过来的参数，我们没有做严格的有效性检查或者限制，最终导致不符合要求的数据将程序搞挂。比如我们提供了一个用户信息批量查询的接口，参数是一个数组。结果是某个调用方传了有1000个元素的数组过来，最终可能直接导致程序内存溢出……这种情况我们能去怪罪调用方吗？严格来说，我们不能，在这里可以借鉴一句经典的话：不要相信前端传来的任何数据。我想对于接口也是一样：不要相信调用端传来的任何数据。</p>
<p>还有一种情况就是系统处理能力的保护，最典型的就是QPS。如果我们的系统能够承受的QPS是100，那么如果QPS超过这个数值，我们该怎么办？我想很多人心里已经有了答案了。</p>
<h1 id="4-连接不关闭"><a href="#4-连接不关闭" class="headerlink" title="4.连接不关闭"></a>4.连接不关闭</h1><p>这里其实是有两点要强调，连接和流。</p>
<h2 id="4-1-连接不关闭"><a href="#4-1-连接不关闭" class="headerlink" title="4.1 连接不关闭"></a>4.1 连接不关闭</h2><p>说到连接，这里所说的是网络连接。我们都知道，网络资源是一种受限资源，无限制的网络连接会给自身及对方系统带来很大的压力，因此我们会使用连接池或其他连接复用技术来降低系统压力，以此提高效率。但是如果我们忘记了关闭连接的话，就会对对端系统带来隐患。比如数据库连接，如果忘记关闭，会造成数据库服务器连接资源耗尽最终导致拒绝服务。当然有同学说，现在很多服务器都有超时检查机制，长时间不活动的连接会自动清除。那么你想过没有，如果连接被服务器断开，这种情况下客户端是感知不到的。只有你下次使用的时候才发现连接已经不可用了。</p>
<h2 id="4-2-流不关闭"><a href="#4-2-流不关闭" class="headerlink" title="4.2 流不关闭"></a>4.2 流不关闭</h2><p>流的问题很好理解，我们读写文件、网络传输，很多很多场景需要使用流，而在操作系统层面，对文件、网络的操作都是有限制的。在使用流的时候，我们首先需要进行open，最后close。如果我们忘记了close，那么系统就不会释放对此资源的占用，最终超出系统限制而导致后续的操作失败，最典型的错误就是too many open files。</p>
<h1 id="5-异步不回调"><a href="#5-异步不回调" class="headerlink" title="5.异步不回调"></a>5.异步不回调</h1><p>在分布式服务架构中，很多的服务为了提高并发处理能力，使用了异步机制。异步的好处是消费端可以不必一直等待服务端的结果，而将资源交给其他的逻辑处理。当服务端有结果返回时，通过回调机制调用消费端的逻辑进行后续的处理。但是在实际的使用过程中，发现很多人还是使用同步的方式来调用异步方法，比如：</p>
<pre><code>fooService.findFoo(fooId); //fooService.findFoo方法支持异步
Future&lt;Foo&gt; fooFuture = RpcContext.getContext().getFuture(); 

Foo foo = fooFuture.get(); // 如果foo已返回，直接拿到返回值，否则线程wait住，等待foo返回后，线程会被notify唤醒
</code></pre><p>我们知道Future对象具有如下的特性：</p>
<ol>
<li>异步执行，可用 get 方法获取执行结果；</li>
<li>如果计算还没完成，get 方法是会阻塞的，如果完成了，是可以多次获取并立即得到结果的；</li>
<li>如果计算还没完成，是可以取消计算的；</li>
<li>可以查询计算的执行状态</li>
</ol>
<p>所以上述的代码问题主要出现在第3行，如果fooService.findFoo方法还没有返回值，那么fooFuture.get()方法会被阻塞直到结果返回，这样就失去了异步调用的优势了。</p>
<p>那么针对上面的代码，正确的写法应该是通过回调机制做数据返回时的处理：</p>
<pre><code>fooService.findFoo(fooId);  

ResponseFuture future = ((FutureAdapter)RpcContext.getContext().getFuture()).getFuture();
future.setCallback(new ResponseCallback(){
    public void done(Object response){
       //调用正常的时候执行
    }

    public void caught(Throwable exception){
      //调用异常的时候执行
    }
});
</code></pre><p>当然，上面的方式只是举了个栗子，具体情况需要根据不同的RPC框架去做处理。这里推荐Google guava concurrent包里面的接口和工具类，比如ListenableFuture、Futures等，具体实例网上有很多的说明，请大家自行安利，这里就不做赘述了。</p>
<h1 id="6-异常不监控"><a href="#6-异常不监控" class="headerlink" title="6.异常不监控"></a>6.异常不监控</h1><p>当系统抛出异常被捕获后，很多同学只是通过日志记录了一下异常信息，但是并没有通过监控系统记录异常。这样带来的隐患就是我们没法在第一时间感知系统异常，只能是影响到其他监控了才会有所体现，但这样就只能靠运气了。如果被影响的监控比较敏感，或许很快就会有告警；但是如果被影响的监控不敏感，或者压根没开告警，那么你就呵呵了……</p>
<h1 id="7-堆外不清理"><a href="#7-堆外不清理" class="headerlink" title="7.堆外不清理"></a>7.堆外不清理</h1><p>在某些业务场景下，我们可能需要使用DirectByteBuffer分配字节缓冲区，或者使用MappedByteBuffer做内存映射，那么我们不可避免地需要使用堆外内存。DirectByteBuffer对象在创建过程中会先通过Unsafe接口直接通过os::malloc来分配内存，然后将内存的起始地址和大小存到DirectByteBuffer对象里，这样就可以直接操作这些内存。我们dump内存时可能会发现DirectByteBuffer对象很小，但是其实它后面可能关联了一个非常大的堆外内存，因此我们通常称之为“冰山对象”。这些内存只有在DirectByteBuffer回收掉之后才有机会被回收，因此如果这些对象大部分都移到了old，但是一直没有触发CMS GC或者Full GC，那么悲剧将会发生，因为你的物理内存被他们耗尽了，因此为了避免这种悲剧的发生，通过-XX:MaxDirectMemorySize来指定最大的堆外内存大小，当使用达到了阈值的时候将调用System.gc来做一次full gc，以此来回收掉没有被使用的堆外内存。</p>
<p>另外，当前我们的使用的服务框架、第三方组件，很多都是基于netty、mina这种NIO框架实现网络调用，而这些NIO框架基本都在使用堆外内存。而我们知道，堆外内存是无法通过JVM的垃圾回收器回收的，只能通过System.gc()来回收。但是很多同学在设置JVM参数的时候，往往选择拷贝已有的配置，而忽略了一个很重要的参数DisableExplicitGC，这个参数的意思是禁用显式GC，也就是使System.gc()失效。如果我们在jvm参数中配置了-XX:+DisableExplicitGC，那么带来的后果就是进入到老年代的堆外内存无法被回收掉，最终导致OOM。</p>
<p>至此，一日丧命散的其中毒虫就介绍完了。如果想要活得久，请远离这七条毒虫，哈哈。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://fengfu.io/2016/10/27/晋级Review归来话代码有毒/" data-id="cj3vdyj1t0013gcx0zrak0h0a" class="article-share-link" data-share="baidu" data-title="晋级Review归来话代码有毒">分享到</a>
      

      
        <a href="http://fengfu.io/2016/10/27/晋级Review归来话代码有毒/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/杂谈/">杂谈</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-让你变成优秀程序员的几个小习惯" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/24/让你变成优秀程序员的几个小习惯/" class="article-date">
  <time datetime="2016-10-24T11:39:22.000Z" itemprop="datePublished">2016-10-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/24/让你变成优秀程序员的几个小习惯/">让你变成优秀程序员的几个小习惯(转)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>译文链接：<a href="http://www.codeceo.com/article/habits-to-be-better-programmer.html" target="_blank" rel="external">http://www.codeceo.com/article/habits-to-be-better-programmer.html</a></p>
<p>英文原文：<a href="https://www.quora.com/What-little-habits-made-you-a-better-software-engineer?srid=ieH" target="_blank" rel="external">What little habits made you a better software engineer?</a></p>
<p>翻译作者：<a href="http://www.codeceo.com/" target="_blank" rel="external">码农网</a> – 小峰</p>
<p>作者Jeff Standen，有着21+年经验的软件开发者。</p>
<p><strong>首先开发spike解决方案</strong>——这是我早期敏捷/极限编程所养成的习惯之一。spike解决方案是一次性原型，可以帮助你在投入大量时间和精力之前验证你是否走对路。</p>
<p>区别就在于原型，因为你遵循这样一个规则，在你完成研究之后，你最终会扔掉“spike”代码。所以允许你偷工减料，迅速行动，因为它不会出现在产品或代码审查中。</p>
<p>此方法有助于迅速发现设计的哪些部位尚不明确，而不必过早地尝试架构或设计决策。</p>
<p><strong>致力于小而连贯代码块的版本控制</strong>——通过类似CVS/Subversion，每次提交都直接发送到服务器。做部分文件的提交并不简单。</p>
<p>随着Git的出现，只提交较大文件的若干行代码变得很容易，并且可以在push到远程代码仓库之前先本地rebase/merge提交。</p>
<p>有一次，我在工作于更大功能的时候，采用了小型增量提交，我的工作效率直线上升。这样做能够清空我的大脑以便于面对更重要的事情。</p>
<p><strong>经常写代码</strong>——最近，我正工作于：一个基于Web的企业协作和自动化平台（PHP / MySQL），一个基于云的实时指标聚合器和使用循环哈希（Node.js/ Redis）的API，一个面向iOS app商店（Swift/ SpriteKit）的棋盘游戏，专门的基于URL的cronjob可替代基于web的SaaS服务（JAVA），等等。</p>
<p>用过大量框架和语言有助于我的抽象和算法思维。</p>
<p>我从工具，如Eclipse RCP、Tapestry和Hibernate中学到了很多伟大的经验教训，并用到我的PHP项目里。尤其是在2000年初，在有Java特征的企业生态系统用于PHP存在之前。我从Unity3d/C＃学到了很多关于网络和面向消息的架构。</p>
<p>如果我只坚持单一平台和社区的话，就永远不会知道这些概念。</p>
<p><strong>编写简单的代码</strong>——我以前习惯于写复杂的代码以作为对自己的挑战。而现在的挑战是要编写优雅且简单的代码——到一种每个人都觉得他们也能做到的地步（即使他们不能）。简单代码通常来自于若干次复杂代码的迭代。</p>
<p>引用Antoine de Saint Exupéry的话就是：“不是没有什么可添加，而是没有什么可消减的时候，才算是达到了完美。”</p>
<p>这也使得我们在长时间休止之后返回项目，以及鼓励其他人参与进来变得容易多了。</p>
<p><strong>最后优化</strong>——我们很容易掉入试图比用户或计算机更聪明，并且预优化各种边缘情况的陷阱。关注帕累托法则（80％的效果来自于20％的工作）。写代码，运行代码，当必要的时候专注于最大的瓶颈。这也支持保持代码库的简单。</p>
<p>说“不要首先优化代码”并不意味着“编写粗糙的代码”。代码总是应该精益和优雅，没有必要画蛇添足，不要将一整天的时间用在挤压剩下的10％，但其实已经能够工作良好的一些东西上。不但工作效率会下降，而且还会引进更多复杂性，解决方案变得不那么可归纳，等等。</p>
<p><strong>着眼于“最重要的事情优先”</strong>——总是有一些项目领域比其他的更有趣或更具挑战性。工作于那些有趣的东西总是比工作于那些必要的东西更有诱惑。</p>
<p>在攻克重要部分时，将有趣部分作为一种调剂，也就是说，两者都做一点也是可以。</p>
<p>因此，光从这一点上说，将大的问题分解成小问题的理念是不言自明的。每个人都懂。所以，我会通过计分若干“quick wins”来开启我的一天，这能让我更有冲劲和更专注（“quick wins”可以是任何东西，包括有趣又小型的挑战），然后我会首先冲向“最重要的事情”。</p>
<p><strong>了解全栈</strong>——当我刚开始干这一行的时候，没有什么比等别人做完他们那部分东西，然后我才能继续我那部分工作更糟糕的了（设计师，后端人员，前端人员，数据库人员，服务器人员，等等）。</p>
<p>于是，当我2000年创办自己的软件开发公司的时候，我做了一个明智的决定，那就是涉猎全栈。我知道我不可能擅长所有东西，也不可能是最后唯一对所有一切负责的人，但我想要做终端到终端的原型，因为我没有耐心看过程。</p>
<p>每当我需要的东西触碰到我不懂的领域时，我会研究它。于是乎，我学会了服务器管理，数据库管理，设计，前端/后端开发，云架构等。</p>
<p>通过了解其他领域是做什么的，我才能写出包含它们需要的代码。</p>
<p>当然，其中的一些要点似乎并不是所谓的“小习惯”，但我向你保证，它们是小变化历经20年时间导致的结果。重要的行为变化并没有意义，更多的是关于我是如何频繁地练习这门技术（在过去10年时间中每年大概4000-5000个小时）。</p>
<p>所以，我的做法更像是去回答这个问题：“什么样的小习惯会导致更糟糕的软件和低效的生产力？”，然后反过来。</p>
<h1 id="作者Ed-Prentice，软件工程师"><a href="#作者Ed-Prentice，软件工程师" class="headerlink" title="作者Ed Prentice，软件工程师"></a>作者Ed Prentice，软件工程师</h1><p>时间是宝贵的，所以要尽可能地节省时间。尽可能自动化。一旦时间成为一种商品，那么你可以实现下一个伟大的创新。</p>
<p>使用功能强大的IDE（如vim），并将其配置能为你做尽可能多的事情。力争单个命令Build/Test/Deploy/Run。</p>
<p>如果你发现自己常做某件事情，那么可以让它们在一个按键下发生，或者一次点击下发生。或者更好的是，让它们自动发生。</p>
<p>了解键盘快捷键和UNIX命令行。几乎所有的IDE都可以让你运行复杂的编译命令，甚至任意的终端命令——不但强大，并且可以为你节省大量的时间。</p>
<p>提问题，然后提更多的问题。如果有什么你不明白的事情发生了，那就问为什么。然后走开，研究替代方案，并提出来。一直问问题直到你可以详细地给下一个问为什么的开发人员解释。我时常感到奇怪为什么会有这么多开发人员不知道为什么，仅仅是因为觉得“它总是/曾是这样”。</p>
<p>通过提供更好的替代解决方案挑战现状——并且制定步骤实现。如果你的测试不完整，或每天/每周运行一次——那么成为本地的Continuous Integration大师——目的是为了有利于你的团队，并实现它。一旦你使用它并且它可以帮助你更好工作的话，那么让你的团队也使用它。</p>
<p>不要只是挑战别人，挑战自己。从来没有写过web应用程序？那么写一个。从未用过Python？用Python劫持无人飞行器。</p>
<p>拥有一些东西。创造一些东西。没有必是非要做技术项目，可以是一个事件，例如聚会或编程马拉松，也可以是一个游戏，一个网站，一个博客。</p>
<p>教一些东西。Java，公开演讲，写作，下棋，vim，网球。</p>
<p>成为一个杰出的人。拿到一个垃圾类/组件？修复好它。编写代码的正确途径。不在代码中走捷径。做出明智的决策，向你周围的人说明为什么你要做这个决定的利弊。总是改善代码。制定不需要花费1小时的待办事项表？Just Do It。</p>
<p>浏览你熟悉的Stack Exchange的话题——例如你喜欢的语言。当你发现什么新的东西的时候，尽快末位淘汰相关知识。知道C语言？什么是分支预测？这篇文章会告诉你——你要做的就是学习。</p>
<p>浏览你不熟悉的Stack Exchange的话题——好好学习，天天向上。</p>
<p>学会沟通。书面文字，呈现展示，解决问题，小却激烈的小项目，大型团队，小型团队。</p>
<p>文档化你的所有过程。你可以回头查阅你为什么做这些事情，以及依赖原先的解决方案去解决碰到的相似问题。这还有助于捕捉你可能会忘记的思维过程和关键的信息片段。我经常通过日志来回顾前几天的工作。</p>
<p>在你写之前文档化你的代码。使用系统图，类层次结构，流程图表，以展示说明你的代码将如何工作。如果有人提出建议——是的，他们会提出来的——那么你可以进行修改，这比已经写好了代码再去修改要容易得多。这是另一个我很少看到有人会做但却有着最负面影响的事情。</p>
<p>特定化。为新的东西制作图表，向大家展示。收集尽可能多的细节。确保每个人同意这个图表。如果有人提出了建议，那就补充/添加更正到图表。保持图表更新。</p>
<p>知道潜意思的偏见和男性特权。了解你是哪种MBTI和人格类型，并且更重要的是，要知道如何与其他性格类型更好地互动。了解情商。每个人都是不一样的，你需要知道如何与他们进行最有效和最有建设性的交互。</p>
<p>定期为团队做一些事情。带饼干。教魔术。培育一点文化，并鼓励其他人也这样做。赞美其他人的贡献。一支有凝聚力的团队是很难被击败的。</p>
<p>学习如何与人合作。我个人非常喜欢《The Pragmatic Programmer》的“stone snop”。</p>
<p>理解和使用别人的代码。如果你正在实现自己的XML解析器或或csv阅读器或git hook，那么你就是在重新发明轮子。</p>
<p>一旦你写了代码，并且它是有效的，通过测试的，那么回过头去整理一下吧。重新运行测试。再整理。每个类都应该有单一的职责，每个函数都应该只做一件事情。在大多数情况下，函数应该小于20行代码的长度。使用自文档的函数名和变量名。花时间整理你的代码以后将会10倍地回报给你和你的团队。</p>
<p>参与其中。承担责任。如果事情有不对的地方，那就解决它。如果最后期限临近了又想出了一个解决方案，那让其他人尽快知道。任何人都可以做到这一点，即使是最初级的开发人员。这要求对项目的蓝图，方向和截止期限有着大局观的认识——参与进来。保存好每天的工作内容！</p>
<p>和团队分享学到的经验教训（在适当的时候）。指出Java中finally块内部抛出异常的时候发生了什么？和大家一起分享。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://fengfu.io/2016/10/24/让你变成优秀程序员的几个小习惯/" data-id="cj3vdyj2f001sgcx0hkb3jop9" class="article-share-link" data-share="baidu" data-title="让你变成优秀程序员的几个小习惯(转)">分享到</a>
      

      
        <a href="http://fengfu.io/2016/10/24/让你变成优秀程序员的几个小习惯/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/杂谈/">杂谈</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-接口文档参考模板" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/23/接口文档参考模板/" class="article-date">
  <time datetime="2016-08-23T01:50:26.000Z" itemprop="datePublished">2016-08-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/23/接口文档参考模板/">接口文档参考模板</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>虽然提供了在线接口参数的查看，但在和客户端对接过程中，我们作为后台开发，还是需要人工提供接口文档给客户端的，这里提供一个接口文档编写的模板，以供参考，并且以我们熟悉的?service=User.GetBaseInfo为例说明如何编写高效的文档。  </p>
<p> <em>温馨提示：斜体字表示是注释说明</em>。  </p>
<p>##功能说明<br><em>对接口功能的简单说明。</em><br>获取用户的基本信息。</p>
<p>##接口URL<br><em>请求的相对链接和当前接口级参数，通常为?service=XXX.XXX + 公共接口参数。</em><br>/demo/?service=User.GetBaseInfo  </p>
<h2 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a><a href="http://phalapi.oschina.mopaas.com/Public/demo/checkApiParams.php?service=User.GetBaseInfo" target="_blank" rel="external">参数说明</a></h2><p><em>对当前接口级参数的说明，建议使用在线接口参数查询工具，但以下的参数说明也是需要的。</em>  </p>
<table>
<thead>
<tr>
<th>参数</th>
<th>名字</th>
<th>是否必须</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>userId</td>
<td>用户ID</td>
<td>是</td>
<td>表示用户的ID</td>
<td>&amp;user_iduser_id=1</td>
</tr>
</tbody>
</table>
<p>##返回参数<br><em>对当前接口级返回参数的说明，即对{“ret”:返回状态码,”data”:”应该业务数据”,”msg”:”错误提示”}中的data部分进行说明。</em>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;ret&quot;: 200,</div><div class="line">    &quot;data&quot;: &#123;</div><div class="line">        &quot;code&quot;: 0,  //code=0表示正确获取用户信息，code=1时表示用户不存在</div><div class="line">        &quot;msg&quot;: &quot;&quot;,   //业务提示文案</div><div class="line">        &quot;info&quot;: &#123;  //仅当code=0的情况下非空且有用户信息</div><div class="line">            &quot;id&quot;: &quot;1&quot;,  //用户ID   </div><div class="line">            &quot;name&quot;: &quot;dogstar&quot;,  //用户名</div><div class="line">            &quot;from&quot;: &quot;oschina&quot;  //用户来源</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    &quot;msg&quot;: &quot;&quot;</div><div class="line">&#125;</div><div class="line">```  	  </div><div class="line"></div><div class="line">  </div><div class="line">##示例</div><div class="line"> _至少应包括成功示例，失败示例可选_     </div><div class="line">  </div><div class="line">###成功示例</div><div class="line">请求：</div></pre></td></tr></table></figure>
<p><a href="http://phalapi.oschina.mopaas.com/Public/demo/?service=User.GetBaseInfo&amp;user_iduser_id=1" target="_blank" rel="external">http://phalapi.oschina.mopaas.com/Public/demo/?service=User.GetBaseInfo&amp;user_iduser_id=1</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">返回：</div></pre></td></tr></table></figure></p>
<p>{<br>    “ret”: 200,<br>    “data”: {<br>        “code”: 0,<br>        “msg”: “”,<br>        “info”: {<br>            “id”: “1”,<br>            “name”: “dogstar”,<br>            “from”: “oschina”<br>        }<br>    },<br>    “msg”: “”<br>}<br>```</p>
<hr>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://fengfu.io/2016/08/23/接口文档参考模板/" data-id="cj3vdyj1v0018gcx00kzhgclv" class="article-share-link" data-share="baidu" data-title="接口文档参考模板">分享到</a>
      

      
        <a href="http://fengfu.io/2016/08/23/接口文档参考模板/#ds-thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/杂谈/">杂谈</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>
</section>
      
      <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/人生/">人生</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/商业/">商业</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微服务/">微服务</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/性能/">性能</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/杂谈/">杂谈</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a><span class="tag-list-count">6</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/人生/" style="font-size: 10px;">人生</a> <a href="/tags/商业/" style="font-size: 10px;">商业</a> <a href="/tags/微服务/" style="font-size: 12.5px;">微服务</a> <a href="/tags/性能/" style="font-size: 10px;">性能</a> <a href="/tags/杂谈/" style="font-size: 17.5px;">杂谈</a> <a href="/tags/架构/" style="font-size: 15px;">架构</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">二月 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">一月 2015</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/06/13/Linux性能分析工具/">Linux性能分析工具</a>
          </li>
        
          <li>
            <a href="/2017/04/11/使用JRebel远程热部署Class/">使用 jrebel 远程部署开发环境的 dubbo 服务</a>
          </li>
        
          <li>
            <a href="/2017/03/06/Spring Xml扩展机制/">Spring xml扩展机制</a>
          </li>
        
          <li>
            <a href="/2016/12/14/jcmd命令详解/">jcmd命令详解</a>
          </li>
        
          <li>
            <a href="/2016/11/23/服务化架构-注册与发现/">服务化架构-注册与发现</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://coolshell.cn" target="_blank">酷壳</a>
          </li>
        
          <li>
            <a href="http://ifeve.com" target="_blank">并发编程网</a>
          </li>
        
          <li>
            <a href="http://calvin1978.blogcn.com" target="_blank">花钱的年化</a>
          </li>
        
          <li>
            <a href="http://lovestblog.cn" target="_blank">你假笨</a>
          </li>
        
          <li>
            <a href="http://hellojava.info" target="_blank">hellojava</a>
          </li>
        
          <li>
            <a href="http://techblog.netflix.com" target="_blank">Netflix技术博客</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 宁静·致远<br>
      Powered by <a href="//hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<!-- 多说公共js代码 start -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"qufengfu"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共js代码 end -->


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/script.js"></script>

</div>
</body>
</html>
